<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="devMSMs">
<title>Workflow: Continuous Exposure • devMSMs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Workflow: Continuous Exposure">
<meta property="og:description" content="devMSMs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">devMSMs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Terminology.html">Terminology</a>
    <a class="dropdown-item" href="../articles/Data_Requirements.html">Data Requirements</a>
    <a class="dropdown-item" href="../articles/Specify_Core_Inputs.html">Specify Core Inputs</a>
    <a class="dropdown-item" href="../articles/Preliminary_Steps.html">Recommended Preliminary Steps</a>
    <a class="dropdown-item" href="../articles/Workflow_Continuous_Exposure.html">Workflow: Continuous Exposure</a>
    <a class="dropdown-item" href="../articles/Customize_Balancing_Formulas.html">Customize Balancing Formulas</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/istallworthy/devMSMs/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Workflow: Continuous Exposure</h1>
                        <h4 data-toc-skip class="author">Isabella
Stallworthy</h4>
            
            <h4 data-toc-skip class="date">2024-03-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/istallworthy/devMSMs/blob/HEAD/vignettes/Workflow_Continuous_Exposure.Rmd" class="external-link"><code>vignettes/Workflow_Continuous_Exposure.Rmd</code></a></small>
      <div class="d-none name"><code>Workflow_Continuous_Exposure.Rmd</code></div>
    </div>

    
    
<p><br></p>
<p>This vignette guides a user through the process of using
<em>devMSMs</em> to fit marginal structural models (MSMs) with a a
continuously distributed exposure variable. The users should first view
the
<a href="https://istallworthy.github.io/devMSMs/articles/Terminology.html">Terminology</a>,
<a href="https://istallworthy.github.io/devMSMs/articles/Data_Requirements.html">Data
Requirements</a>,
<a href="https://istallworthy.github.io/devMSMs/articles/Specify_Core_Inputs.html">Specifying
Core Inputs</a>, and
<a href="https://istallworthy.github.io/devMSMs/articles/Preliminary_Steps.html">Recommended
Preliminary Steps</a> vignettes.</p>
<p>The code contained in this vignette is also available, integrated
code from the other vignettes, in the
<a href="https://github.com/istallworthy/devMSMs/blob/main/examplePipelineRevised.Rmd" class="external-link">examplePipeline.rmd
file</a>. This workflow is designed to complement the conceptual and
high-level practical details provided in the manuscript <em>[add link
here]</em>. We strongly suggest users familiarize themselves with
concepts of the MSM process outlined in the manuscript and the practical
steps and functions put forth in the following sections before
implementing this workflow.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"istallworthy/devMSMs"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"istallworthy/devMSMsHelpers"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://istallworthy.github.io/devMSMs/">devMSMs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">devMSMsHelpers</span><span class="op">)</span></span></code></pre></div>
<p>All <em>devMSMs</em> functions have optional arguments to suppress
saving output locally (<code>save.out = FALSE</code>) and printing it to
the console (<code>verbose = FALSE</code>). The defaults to both
arguments are TRUE, as recommended for use of the package’s full
functionality. Users must supply a path to a home directory
(<code>home_dir</code>) if <code>save.out = TRUE</code>. All sub-folders
referenced by each function are created automatically within the home
directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">save.out</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="va">verbose</span> <span class="op">=</span> <span class="cn">TRUE</span></span></code></pre></div>
<p><br></p>
<div class="section level3">
<h3 id="load-data">Load Data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h3>
<p>We first load in imputed datasets as a mice object. These data are
simulated based on data from the Family Life Project (FLP), a
longitudinal study following 1,292 families representative of two
geographic areas (three counties in North Carolina and three counties in
Pennsylvania) with high rural child poverty (Vernon-Feagans et al.,
2013; Burchinal et al., 2008). We take the example exposure of economic
strain (ESETA1) measured at 6, 15, 24, 35, and 58 months in relation to
the outcome of behavior problems (StrDif_Tot) measured at 58 months.
(See
<a href="https://istallworthy.github.io/devMSMs/articles/Preliminary_Steps.html">Recommended
Preliminary Steps vignette</a> for beginning with other data types,
including missing data).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sim_data_mice"</span>, package <span class="op">=</span> <span class="st">"devMSMs"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">sim_data_mice</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="va">data</span>, <span class="fl">1</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ALI_Le.35 B18Raw.15 B18Raw.24 B18Raw.58 B18Raw.6 BioDadInHH2 caregiv_health</span></span>
<span><span class="co">#&gt; 1         3         1         1         7       16           1              3</span></span>
<span><span class="co">#&gt; 2         2         4        -7         7        0           0              0</span></span>
<span><span class="co">#&gt; 3         3         6         5        20       -1           0              3</span></span>
<span><span class="co">#&gt; 4         4        24        25        17       11           0              3</span></span>
<span><span class="co">#&gt; 5         3        -8        -9        17        1           1              2</span></span>
<span><span class="co">#&gt;   CORTB.15 CORTB.24 CORTB.6</span></span>
<span><span class="co">#&gt; 1   -0.227   -0.652   0.742</span></span>
<span><span class="co">#&gt; 2    0.149    0.831   0.018</span></span>
<span><span class="co">#&gt; 3    1.145    0.033  -0.379</span></span>
<span><span class="co">#&gt; 4    0.301   -0.501   0.000</span></span>
<span><span class="co">#&gt; 5   -0.247    0.084   0.153</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="core-inputs">Core Inputs<a class="anchor" aria-label="anchor" href="#core-inputs"></a>
</h3>
<p>Please see the
<a href="https://istallworthy.github.io/devMSMs/articles/Specify_Core_Inputs.html">Specifying
Core Inputs vignette</a> for more detail on the following core
inputs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="va">home_dir</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="co"># home_dir &lt;- '/Users/isabella/Library/CloudStorage/Box-Box/BSL General/MSMs/testing/isa' #note: no / after</span></span>
<span></span>
<span><span class="va">exposure</span> <span class="op">&lt;-</span> <span class="st">"ESETA1"</span></span>
<span></span>
<span><span class="va">exposure_time_pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">15</span>, <span class="fl">24</span>, <span class="fl">35</span>, <span class="fl">58</span><span class="op">)</span></span>
<span></span>
<span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="st">"StrDif_Tot.58"</span></span>
<span></span>
<span><span class="va">tv_confounders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SAAmylase.6"</span>,<span class="st">"SAAmylase.15"</span>, <span class="st">"SAAmylase.24"</span>,</span>
<span>                    <span class="st">"MDI.6"</span>, <span class="st">"MDI.15"</span>,                                            </span>
<span>                    <span class="st">"RHasSO.6"</span>, <span class="st">"RHasSO.15"</span>, <span class="st">"RHasSO.24"</span>,<span class="st">"RHasSO.35"</span>, <span class="st">"RHasSO.58"</span>,                                         </span>
<span>                    <span class="st">"WndNbrhood.6"</span>,<span class="st">"WndNbrhood.24"</span>, <span class="st">"WndNbrhood.35"</span>, <span class="st">"WndNbrhood.58"</span>,                                       </span>
<span>                    <span class="st">"IBRAttn.6"</span>, <span class="st">"IBRAttn.15"</span>, <span class="st">"IBRAttn.24"</span>,                                   </span>
<span>                    <span class="st">"B18Raw.6"</span>, <span class="st">"B18Raw.15"</span>, <span class="st">"B18Raw.24"</span>, <span class="st">"B18Raw.58"</span>,                                           </span>
<span>                    <span class="st">"HOMEETA1.6"</span>, <span class="st">"HOMEETA1.15"</span>, <span class="st">"HOMEETA1.24"</span>, <span class="st">"HOMEETA1.35"</span>, <span class="st">"HOMEETA1.58"</span>,                               </span>
<span>                    <span class="st">"InRatioCor.6"</span>, <span class="st">"InRatioCor.15"</span>, <span class="st">"InRatioCor.24"</span>, <span class="st">"InRatioCor.35"</span>, <span class="st">"InRatioCor.58"</span>,                         </span>
<span>                    <span class="st">"ESETA1.6"</span>, <span class="st">"ESETA1.15"</span>, <span class="st">"ESETA1.24"</span>, <span class="st">"ESETA1.35"</span>, <span class="st">"ESETA1.58"</span>,              </span>
<span>                    <span class="st">"CORTB.6"</span>, <span class="st">"CORTB.15"</span>, <span class="st">"CORTB.24"</span>,                                                                  </span>
<span>                    <span class="st">"EARS_TJo.24"</span>, <span class="st">"EARS_TJo.35"</span>,                                        </span>
<span>                    <span class="st">"LESMnPos.24"</span>, <span class="st">"LESMnPos.35"</span>,                                  </span>
<span>                    <span class="st">"LESMnNeg.24"</span>, <span class="st">"LESMnNeg.35"</span>,       </span>
<span>                    <span class="st">"StrDif_Tot.35"</span>, <span class="st">"StrDif_Tot.58"</span>,    </span>
<span>                    <span class="st">"fscore.35"</span>, <span class="st">"fscore.58"</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ti_confounders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"BioDadInHH2"</span>, <span class="st">"PmAge2"</span>, <span class="st">"PmBlac2"</span>, <span class="st">"TcBlac2"</span>, <span class="st">"PmMrSt2"</span>, <span class="st">"PmEd2"</span>, <span class="st">"KFASTScr"</span>,</span>
<span>                    <span class="st">"RMomAgeU"</span>, <span class="st">"RHealth"</span>, <span class="st">"HomeOwnd"</span>, <span class="st">"SWghtLB"</span>, <span class="st">"SurpPreg"</span>, <span class="st">"SmokTotl"</span>, <span class="st">"DrnkFreq"</span>,</span>
<span>                    <span class="st">"peri_health"</span>, <span class="st">"caregiv_health"</span>, <span class="st">"gov_assist"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="phase-1-confounder-adjustment">Phase 1: Confounder Adjustment<a class="anchor" aria-label="anchor" href="#phase-1-confounder-adjustment"></a>
</h2>
<p>The goal of this first phase is to minimize the associations between
confounders and exposure using IPTW balancing weights. We strongly
advise the user to carefully inspect each balancing formula to ensure
weights are created and evaluated appropriately at each step.</p>
<p><br></p>
<div class="section level3">
<h3 id="step-1--create-full-balancing-formulas-conduct-pre-balance-checking">Step 1. Create Full Balancing Formulas &amp; Conduct Pre-Balance
Checking<a class="anchor" aria-label="anchor" href="#step-1--create-full-balancing-formulas-conduct-pre-balance-checking"></a>
</h3>
<p><br></p>
<div class="section level4">
<h4 id="step-1a--create-full-balancing-formulas-at-each-exposure-time-point">Step 1a. Create Full Balancing Formulas at Each Exposure Time
Point<a class="anchor" aria-label="anchor" href="#step-1a--create-full-balancing-formulas-at-each-exposure-time-point"></a>
</h4>
<p>We first create comprehensive, full balancing formulas relating
exposure to confounders at each time point using the
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function (<code>type = “full”</code>).
This step creates full formulas containing all measured confounding
variables at each exposure time point, including all time-invariant
confounders, lagged time-varying confounders, as well as past levels of
the exposure and outcome (make sure they are listed as time-varying
confounders). The code automatically excludes time-varying confounders
at the contemporaneous time point given that they cannot be decisively
differentiated from mediators which should not be balanced on (Thoemmes
&amp; Ong, 2016), although this can be modified by the user if they have
strong reason to believe a concurrent variable is not a mediator (see
below).</p>
<p>To include interactions between covariates in the balancing formulas,
please list those composed of only time invariant covariates (e.g.,
“variable:variable”) as time invariant confounders, and those composed
of both or only time-varying covariates (e.g., “variable.t:variable” or
“variable.t:variable.t”) in the time-varying confounders list.
Interactions containing time-varying covariates will be treated as
time-varying confounders measured at the highest measurement time point
of the constituent time points. Of note, interactions between factor
variables with multiple levels can produce a large number of additional
variables in the balancing formulas.</p>
<p>The required input to create full balancing formulas using the
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function are: exposure (e.g., “variable”),
exposure time points, outcome (e.g., “variable.time”), a list of
time-varying confounders (e.g. “variable.time”), a list of time
invariant confounders (e.g., “variable”), and setting
<code>type = “full”</code>.</p>
<p>Optional inputs to create full balancing formulas using the
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function are as follows.</p>
<p>For <code>concur_conf</code>: as a list, provide the names of any
time-varying confounders (e.g., “variable.time”) that you wish to be
included concurrently in the balancing formulas (overriding the default
which is to only include lagged confounders).</p>
<p>We choose not to specify any concurrent confounders, as we cannot
reliably distinguish them from mediators in our data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">concur_conf</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> </span></code></pre></div>
<p>The user may also specify a list of custom formulas by specifying to
<code>custom</code> a list of formulas, one for each exposure time point
(e.g., “exposure.time ~ variable.time + variable +…”) in formula format,
with each entry named with the formula type and exposure time point
(e.g., “full_form-6”). An abridged example is shown below. We recommend
first running the <code><a href="../reference/createFormulas.html">createFormulas()</a></code> function without custom
formulas (<code>custom = NULL</code>) and using the output as a model of
the required format for custom formulas. The
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function will automatically check custom
formulas to ensure that there is a correctly formatted formula for each
exposure time point with exposure as the dependent variable. However,
the user is responsible for ensuring the custom formulas contain the
appropriate confounders for the formula type they are generating. Please
see the
<a href="https://istallworthy.github.io/devMSMs/articles/Customize_Balancing_Formulas.html">Customize
Balancing Formulas vignette</a> for more detail on how to customize
formulas.</p>
<p>We chose not to create custom formulas and instead use
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> to make them.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> </span></code></pre></div>
<p>The <code><a href="../reference/createFormulas.html">createFormulas()</a></code> function saves out .csv and .rds
files containing balancing formulas at each exposure time point for the
specified <code>type</code> (“full”) in the ‘formulas/full/’ folder.</p>
<p>The function returns a list of formulas labeled by type, exposure,
outcome, and exposure time point.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"full"</span></span>
<span></span>
<span><span class="va">full_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createFormulas.html">createFormulas</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, <span class="co">#required</span></span>
<span>                                type <span class="op">=</span> <span class="va">type</span>, ti_confounders <span class="op">=</span> <span class="va">ti_confounders</span>, tv_confounders <span class="op">=</span> <span class="va">tv_confounders</span>, <span class="co">#required</span></span>
<span>                                concur_conf <span class="op">=</span> <span class="va">concur_conf</span>, custom <span class="op">=</span> <span class="va">custom</span>, <span class="co">#optional</span></span>
<span>                                home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the full balancing formula below:</span></span>
<span><span class="co">#&gt; The full formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 6 is: </span></span>
<span><span class="co">#&gt; ESETA1.6 ~ BioDadInHH2 + caregiv_health + DrnkFreq + gov_assist + </span></span>
<span><span class="co">#&gt;     HomeOwnd + KFASTScr + peri_health + PmAge2 + PmBlac2 + PmEd2 + </span></span>
<span><span class="co">#&gt;     PmMrSt2 + RHealth + RMomAgeU + SmokTotl + state + SurpPreg + </span></span>
<span><span class="co">#&gt;     SWghtLB + TcBlac2</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e745225a0&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the full balancing formula below:</span></span>
<span><span class="co">#&gt; The full formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 15 is: </span></span>
<span><span class="co">#&gt; ESETA1.15 ~ B18Raw.6 + BioDadInHH2 + caregiv_health + CORTB.6 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + ESETA1.6 + gov_assist + HOMEETA1.6 + HomeOwnd + </span></span>
<span><span class="co">#&gt;     IBRAttn.6 + InRatioCor.6 + KFASTScr + MDI.6 + peri_health + </span></span>
<span><span class="co">#&gt;     PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.6 + RHealth + </span></span>
<span><span class="co">#&gt;     RMomAgeU + SAAmylase.6 + SmokTotl + state + SurpPreg + SWghtLB + </span></span>
<span><span class="co">#&gt;     TcBlac2 + WndNbrhood.6</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e745225a0&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the full balancing formula below:</span></span>
<span><span class="co">#&gt; The full formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 24 is: </span></span>
<span><span class="co">#&gt; ESETA1.24 ~ B18Raw.15 + B18Raw.6 + BioDadInHH2 + caregiv_health + </span></span>
<span><span class="co">#&gt;     CORTB.15 + CORTB.6 + DrnkFreq + ESETA1.15 + ESETA1.6 + gov_assist + </span></span>
<span><span class="co">#&gt;     HOMEETA1.15 + HOMEETA1.6 + HomeOwnd + IBRAttn.15 + IBRAttn.6 + </span></span>
<span><span class="co">#&gt;     InRatioCor.15 + InRatioCor.6 + KFASTScr + MDI.15 + MDI.6 + </span></span>
<span><span class="co">#&gt;     peri_health + PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.15 + </span></span>
<span><span class="co">#&gt;     RHasSO.6 + RHealth + RMomAgeU + SAAmylase.15 + SAAmylase.6 + </span></span>
<span><span class="co">#&gt;     SmokTotl + state + SurpPreg + SWghtLB + TcBlac2 + WndNbrhood.6</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e745225a0&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the full balancing formula below:</span></span>
<span><span class="co">#&gt; The full formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 35 is: </span></span>
<span><span class="co">#&gt; ESETA1.35 ~ B18Raw.15 + B18Raw.24 + B18Raw.6 + BioDadInHH2 + </span></span>
<span><span class="co">#&gt;     caregiv_health + CORTB.15 + CORTB.24 + CORTB.6 + DrnkFreq + </span></span>
<span><span class="co">#&gt;     EARS_TJo.24 + ESETA1.15 + ESETA1.24 + ESETA1.6 + gov_assist + </span></span>
<span><span class="co">#&gt;     HOMEETA1.15 + HOMEETA1.24 + HOMEETA1.6 + HomeOwnd + IBRAttn.15 + </span></span>
<span><span class="co">#&gt;     IBRAttn.24 + IBRAttn.6 + InRatioCor.15 + InRatioCor.24 + </span></span>
<span><span class="co">#&gt;     InRatioCor.6 + KFASTScr + LESMnNeg.24 + LESMnPos.24 + MDI.15 + </span></span>
<span><span class="co">#&gt;     MDI.6 + peri_health + PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + </span></span>
<span><span class="co">#&gt;     RHasSO.15 + RHasSO.24 + RHasSO.6 + RHealth + RMomAgeU + SAAmylase.15 + </span></span>
<span><span class="co">#&gt;     SAAmylase.24 + SAAmylase.6 + SmokTotl + state + SurpPreg + </span></span>
<span><span class="co">#&gt;     SWghtLB + TcBlac2 + WndNbrhood.24 + WndNbrhood.6</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e745225a0&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the full balancing formula below:</span></span>
<span><span class="co">#&gt; The full formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 58 is: </span></span>
<span><span class="co">#&gt; ESETA1.58 ~ B18Raw.15 + B18Raw.24 + B18Raw.6 + BioDadInHH2 + </span></span>
<span><span class="co">#&gt;     caregiv_health + CORTB.15 + CORTB.24 + CORTB.6 + DrnkFreq + </span></span>
<span><span class="co">#&gt;     EARS_TJo.24 + EARS_TJo.35 + ESETA1.15 + ESETA1.24 + ESETA1.35 + </span></span>
<span><span class="co">#&gt;     ESETA1.6 + fscore.35 + gov_assist + HOMEETA1.15 + HOMEETA1.24 + </span></span>
<span><span class="co">#&gt;     HOMEETA1.35 + HOMEETA1.6 + HomeOwnd + IBRAttn.15 + IBRAttn.24 + </span></span>
<span><span class="co">#&gt;     IBRAttn.6 + InRatioCor.15 + InRatioCor.24 + InRatioCor.35 + </span></span>
<span><span class="co">#&gt;     InRatioCor.6 + KFASTScr + LESMnNeg.24 + LESMnNeg.35 + LESMnPos.24 + </span></span>
<span><span class="co">#&gt;     LESMnPos.35 + MDI.15 + MDI.6 + peri_health + PmAge2 + PmBlac2 + </span></span>
<span><span class="co">#&gt;     PmEd2 + PmMrSt2 + RHasSO.15 + RHasSO.24 + RHasSO.35 + RHasSO.6 + </span></span>
<span><span class="co">#&gt;     RHealth + RMomAgeU + SAAmylase.15 + SAAmylase.24 + SAAmylase.6 + </span></span>
<span><span class="co">#&gt;     SmokTotl + state + StrDif_Tot.35 + SurpPreg + SWghtLB + TcBlac2 + </span></span>
<span><span class="co">#&gt;     WndNbrhood.24 + WndNbrhood.35 + WndNbrhood.6</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e745225a0&gt;</span></span></code></pre></div>
<p>As shown above, <code><a href="../reference/createFormulas.html">createFormulas()</a></code> creates a balancing
formula for each exposure time point. Each full formula contains all
time invariant confounders as well as all lagged time-varying
confounders at each time point. We inspect each of these formulas to
ensure that they are accurate for creating IPTW balancing weights.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="step-1b--conduct-exploratory-pre-balance-assessment">Step 1b. Conduct Exploratory Pre-Balance Assessment<a class="anchor" aria-label="anchor" href="#step-1b--conduct-exploratory-pre-balance-assessment"></a>
</h4>
<p>The next step examines the initial imbalance, or how strongly
exposure relates to each confounder at each time point, for all measured
confounders prior to weighting using the <code><a href="../reference/assessBalance.html">assessBalance()</a></code>
function (<code>type = “prebalance”</code>). This function draws on the
<code><a href="../reference/calcBalStats.html">calcBalStats()</a></code> function (see the Assessing Balance for
Time-Varying Exposure section in the accompanying manuscript).</p>
<p>The <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function outputs balance statistics
(correlations for continuous exposures and standardized mean differences
for binary exposures) relating exposure at each time point to
confounders in a table as well as in plots. This function also provides
summary balance statistics averaging across all time points (and imputed
datasets if they are supplied).</p>
<p>The required inputs for using the <code><a href="../reference/assessBalance.html">assessBalance()</a></code>
function to conduct pre-balance testing are: complete data (data frame,
a mids object, or a list of imputed datasets as dataframes in wide
format), exposure (e.g., “variable”), exposure time points, outcome
(e.g., “variable.time”), the full formulas (see Step 1a), and setting
<code>type = “prebalance”</code>.</p>
<p>The optional inputs are as follows.</p>
<p>The user may specify <code>balance_thresh</code>, or a threshold(s)
for determining confounder balance, in one of two ways. First, they can
provide a single number value (0-1) for the absolute value of the
standardized balance statistic (either the correlation for continuous
exposures or standardized group mean difference for binary exposures)
for exposure and confounders below which confounders are considered
balanced and above which they are considered imbalanced (default is 0.1;
Stuart, 2010). Second, users may make an a priori assertion that some
confounders are more important than others based on theory and existing
research. In this case, they can provide two numbers that represent the
balance thresholds for important and less important confounders,
respectively. If the user supplies two balance thresholds, they must
also supply a list of important confounders (time-varying: “variable.t”,
time invariant: “variable”) to the <code>imp_conf</code> field. The
balance threshold specification should be kept consistent throughout the
use of this workflow.</p>
<p>As recommended, below we provide two balancing thresholds and
identify income and parent education as important confounders in the
relation between economic strain and behavior problems.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">balance_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">imp_conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"InRatioCor.6"</span>, <span class="st">"InRatioCor.15"</span>, <span class="st">"InRatioCor.24"</span>, <span class="st">"InRatioCor.35"</span>, <span class="st">"InRatioCor.58"</span>, <span class="st">"PmEd2"</span><span class="op">)</span> </span></code></pre></div>
<p>The <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function saves out the following
.csv and .html files into the ‘balance/prebalance/’ folder: tables of
balance statistics for all confounders, tables of balance statistics for
covariates that are imbalanced (with respect to their respective balance
thresholds), and an overall balance summary table (averaged across any
imputed datasets). Within the ‘balance/prebalance/plots/’ folder, the
function outputs .jpeg files of summary love plots depicting confounder
balance for each exposure time point.</p>
<p>The function returns a data frame (or list) of balance statistics,
balance thresholds, and binary balanced tag for each confounder relevant
to each exposure time point.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"prebalance"</span></span>
<span></span>
<span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="va">full_formulas</span></span>
<span></span>
<span><span class="va">prebalance_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, </span>
<span>                                  outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                                  balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                  home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point prior to weighting, using full formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using no weights and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.06 (range = -0.25 - 0.31).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 54 out of 191 (28%) covariates across time points, corresponding to 19 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.13 (range= -0.25-0.31):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using no weights and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|          7|           11| 18|</span></span>
<span><span class="co">#&gt; |       15|         17|           11| 28|</span></span>
<span><span class="co">#&gt; |       24|         28|            9| 37|</span></span>
<span><span class="co">#&gt; |       35|         35|           14| 49|</span></span>
<span><span class="co">#&gt; |       58|         50|            9| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using no weights and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.06 (range = -0.26 - 0.31).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 54 out of 191 (28%) covariates across time points, corresponding to 16 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.13 (range= -0.26-0.31):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using no weights and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|          8|           10| 18|</span></span>
<span><span class="co">#&gt; |       15|         17|           11| 28|</span></span>
<span><span class="co">#&gt; |       24|         28|            9| 37|</span></span>
<span><span class="co">#&gt; |       35|         35|           14| 49|</span></span>
<span><span class="co">#&gt; |       58|         49|           10| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-12-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the full formulas and no weights :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.06 (range = -0.26-0.31).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 51 covariates across time points out of 191 total (26.7%) spanning 17 domains out of 33 (51.52%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.13 (range=-0.26-0.31) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate      |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:--------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |1   |ESETA1   |        6|          0|caregiv_health |  0.1507381|       0.10|        0|</span></span>
<span><span class="co">#&gt; |2   |ESETA1   |        6|          0|gov_assist     |  0.3094303|       0.10|        0|</span></span>
<span><span class="co">#&gt; |3   |ESETA1   |        6|          0|KFASTScr       | -0.1715332|       0.10|        0|</span></span>
<span><span class="co">#&gt; |6   |ESETA1   |        6|          0|PmEd2          | -0.2345618|       0.05|        0|</span></span>
<span><span class="co">#&gt; |7   |ESETA1   |        6|          0|RMomAgeU       | -0.1013945|       0.10|        0|</span></span>
<span><span class="co">#&gt; |9   |ESETA1   |        6|          0|BioDadInHH2    | -0.1339457|       0.10|        0|</span></span>
<span><span class="co">#&gt; |12  |ESETA1   |        6|          0|PmBlac2        |  0.1831382|       0.10|        0|</span></span>
<span><span class="co">#&gt; |13  |ESETA1   |        6|          0|PmMrSt2        | -0.1294765|       0.10|        0|</span></span>
<span><span class="co">#&gt; |16  |ESETA1   |        6|          0|state          |  0.1264565|       0.10|        0|</span></span>
<span><span class="co">#&gt; |17  |ESETA1   |        6|          0|SurpPreg       |  0.1047537|       0.10|        0|</span></span>
<span><span class="co">#&gt; |18  |ESETA1   |        6|          0|TcBlac2        |  0.2077641|       0.10|        0|</span></span>
<span><span class="co">#&gt; |19  |ESETA1   |       15|          6|B18Raw.6       |  0.1348511|       0.10|        0|</span></span>
<span><span class="co">#&gt; |20  |ESETA1   |       15|          0|caregiv_health |  0.1044451|       0.10|        0|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6       |  0.1710106|       0.10|        0|</span></span>
<span><span class="co">#&gt; |23  |ESETA1   |       15|          0|gov_assist     |  0.1711974|       0.10|        0|</span></span>
<span><span class="co">#&gt; |24  |ESETA1   |       15|          6|HOMEETA1.6     | -0.1604780|       0.10|        0|</span></span>
<span><span class="co">#&gt; |26  |ESETA1   |       15|          6|InRatioCor.6   | -0.2553820|       0.05|        0|</span></span>
<span><span class="co">#&gt; |31  |ESETA1   |       15|          0|PmEd2          | -0.1636251|       0.05|        0|</span></span>
<span><span class="co">#&gt; |35  |ESETA1   |       15|          6|WndNbrhood.6   | -0.1182075|       0.10|        0|</span></span>
<span><span class="co">#&gt; |36  |ESETA1   |       15|          0|BioDadInHH2    | -0.1056931|       0.10|        0|</span></span>
<span><span class="co">#&gt; |39  |ESETA1   |       15|          0|PmBlac2        |  0.1302578|       0.10|        0|</span></span>
<span><span class="co">#&gt; |46  |ESETA1   |       15|          0|TcBlac2        |  0.1237223|       0.10|        0|</span></span>
<span><span class="co">#&gt; |47  |ESETA1   |       24|         15|B18Raw.15      |  0.1179930|       0.10|        0|</span></span>
<span><span class="co">#&gt; |48  |ESETA1   |       24|          6|B18Raw.6       |  0.1517987|       0.10|        0|</span></span>
<span><span class="co">#&gt; |52  |ESETA1   |       24|         15|ESETA1.15      |  0.1165981|       0.10|        0|</span></span>
<span><span class="co">#&gt; |53  |ESETA1   |       24|          6|ESETA1.6       |  0.1309916|       0.10|        0|</span></span>
<span><span class="co">#&gt; |54  |ESETA1   |       24|          0|gov_assist     |  0.1551492|       0.10|        0|</span></span>
<span><span class="co">#&gt; |55  |ESETA1   |       24|         15|HOMEETA1.15    | -0.1273566|       0.10|        0|</span></span>
<span><span class="co">#&gt; |59  |ESETA1   |       24|         15|InRatioCor.15  | -0.1077189|       0.05|        0|</span></span>
<span><span class="co">#&gt; |60  |ESETA1   |       24|          6|InRatioCor.6   | -0.1490615|       0.05|        0|</span></span>
<span><span class="co">#&gt; |66  |ESETA1   |       24|          0|PmEd2          | -0.1077925|       0.05|        0|</span></span>
<span><span class="co">#&gt; |92  |ESETA1   |       35|         15|ESETA1.15      |  0.1307700|       0.10|        0|</span></span>
<span><span class="co">#&gt; |93  |ESETA1   |       35|         24|ESETA1.24      |  0.1225735|       0.10|        0|</span></span>
<span><span class="co">#&gt; |94  |ESETA1   |       35|          6|ESETA1.6       |  0.1058747|       0.10|        0|</span></span>
<span><span class="co">#&gt; |95  |ESETA1   |       35|          0|gov_assist     |  0.1240766|       0.10|        0|</span></span>
<span><span class="co">#&gt; |96  |ESETA1   |       35|         15|HOMEETA1.15    | -0.1020384|       0.10|        0|</span></span>
<span><span class="co">#&gt; |97  |ESETA1   |       35|         24|HOMEETA1.24    | -0.1201732|       0.10|        0|</span></span>
<span><span class="co">#&gt; |98  |ESETA1   |       35|          6|HOMEETA1.6     | -0.1169161|       0.10|        0|</span></span>
<span><span class="co">#&gt; |102 |ESETA1   |       35|         15|InRatioCor.15  | -0.1401707|       0.05|        0|</span></span>
<span><span class="co">#&gt; |103 |ESETA1   |       35|         24|InRatioCor.24  | -0.1625588|       0.05|        0|</span></span>
<span><span class="co">#&gt; |104 |ESETA1   |       35|          6|InRatioCor.6   | -0.1524431|       0.05|        0|</span></span>
<span><span class="co">#&gt; |112 |ESETA1   |       35|          0|PmEd2          | -0.1185473|       0.05|        0|</span></span>
<span><span class="co">#&gt; |127 |ESETA1   |       35|          6|RHasSO.6       |  0.1141221|       0.10|        0|</span></span>
<span><span class="co">#&gt; |144 |ESETA1   |       58|         35|ESETA1.35      |  0.1119754|       0.10|        0|</span></span>
<span><span class="co">#&gt; |147 |ESETA1   |       58|          0|gov_assist     |  0.1212422|       0.10|        0|</span></span>
<span><span class="co">#&gt; |151 |ESETA1   |       58|          6|HOMEETA1.6     | -0.1019400|       0.10|        0|</span></span>
<span><span class="co">#&gt; |155 |ESETA1   |       58|         15|InRatioCor.15  | -0.1382269|       0.05|        0|</span></span>
<span><span class="co">#&gt; |156 |ESETA1   |       58|         24|InRatioCor.24  | -0.1554733|       0.05|        0|</span></span>
<span><span class="co">#&gt; |157 |ESETA1   |       58|         35|InRatioCor.35  | -0.1316450|       0.05|        0|</span></span>
<span><span class="co">#&gt; |158 |ESETA1   |       58|          6|InRatioCor.6   | -0.1463094|       0.05|        0|</span></span>
<span><span class="co">#&gt; |168 |ESETA1   |       58|          0|PmEd2          | -0.1328850|       0.05|        0|</span></span></code></pre>
<p>The output above shows the initial imbalance between confounders and
exposure in tables and plots. 55 confounders are imbalanced (labeled in
red font in the love plots) with respect to the economic strain exposure
and their respective balance threshold. The love plots depict the
standardized associations between confounder and exposure at each
exposure time point, with the vertical red dashed lines indicating
balance thresholds.</p>
<p><br><br>.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-2--create-simplified-balancing-formulas-determine-optimal-weighting-method">Step 2. Create Simplified Balancing Formulas &amp; Determine Optimal
Weighting Method<a class="anchor" aria-label="anchor" href="#step-2--create-simplified-balancing-formulas-determine-optimal-weighting-method"></a>
</h3>
<p>The goal of this second step is to create shortened, more
parsimonious balancing formulas for determining the optimal IPTW
weighting method that most successfully reduces imbalance.</p>
<p><br></p>
<div class="section level4">
<h4 id="a--create-simplified-balancing-formulas">2a. Create Simplified Balancing Formulas<a class="anchor" aria-label="anchor" href="#a--create-simplified-balancing-formulas"></a>
</h4>
<p>First, we create shorter, more parsimonious balancing formulas
relating exposure to confounders at each time point using the
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function (<code>type = ”short”</code>).
For each exposure time point, these formulas contain all time invariant
confounders as well as time-varying confounders only at the <em>t</em>-1
lag. The logic here is that balancing on confounders at the most recent
prior time point (<em>t</em>-1 only) may achieve balance on levels at
more distal time points, given the stability of many confounders over
time. Importantly, we will empirically assess and relax this assumption
if needed at subsequent steps (Steps 3a-b).</p>
<p>See Step 1a for instructions on how to include confounder
interactions.</p>
<p>The required input to create shortened balancing formulas using the
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function are: exposure (e.g., “variable”),
exposure time points, outcome (e.g., “variable.t”), a list of
time-varying confounders (e.g., “variable.t”), a list of time invariant
confounders, and setting <code>type = “short”</code>.</p>
<p>In addition to the optional input outlined in Step 1a, the user also
has the option to specify in <code>keep_conf</code>, a list of any
time-varying confounders (e.g., “variable.t”) to always retain as lagged
confounders in these shortened formulas. The user may use this argument
to retain specific time-varying confounders that would otherwise be
excluded at this step if they occur at lags greater than <em>t</em>-1
for each formula.</p>
<p>Below, we choose not to specify any confounders to always retain at
this step.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># keep_conf &lt;- "InRatioCor.6"</span></span>
<span></span>
<span><span class="va">keep_conf</span>  <span class="op">&lt;-</span>  <span class="cn">NULL</span> </span></code></pre></div>
<p>The <code><a href="../reference/createFormulas.html">createFormulas()</a></code> function saves out .csv and .rds
files containing balancing formulas at each exposure time point (e.g.,
see below) for the specified type (in this case, “short”) in the
‘formulas/short/’ folder.</p>
<p>The function returns a list of balancing formulas labeled by type,
exposure, outcome, and exposure time point.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"short"</span> </span>
<span></span>
<span><span class="va">short_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createFormulas.html">createFormulas</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, </span>
<span>                                 outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, ti_confounders <span class="op">=</span> <span class="va">ti_confounders</span>, </span>
<span>                                 tv_confounders <span class="op">=</span> <span class="va">tv_confounders</span>, concur_conf <span class="op">=</span> <span class="va">concur_conf</span>, </span>
<span>                                 keep_conf <span class="op">=</span> <span class="va">keep_conf</span>, custom <span class="op">=</span> <span class="va">custom</span>, </span>
<span>                                 home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> </span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the short balancing formula below that includes time-varying confounders at t-1 only:</span></span>
<span><span class="co">#&gt; The short formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 6 is: </span></span>
<span><span class="co">#&gt; ESETA1.6 ~ BioDadInHH2 + caregiv_health + DrnkFreq + gov_assist + </span></span>
<span><span class="co">#&gt;     HomeOwnd + KFASTScr + peri_health + PmAge2 + PmBlac2 + PmEd2 + </span></span>
<span><span class="co">#&gt;     PmMrSt2 + RHealth + RMomAgeU + SmokTotl + state + SurpPreg + </span></span>
<span><span class="co">#&gt;     SWghtLB + TcBlac2</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e796de550&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the short balancing formula below that includes time-varying confounders at t-1 only:</span></span>
<span><span class="co">#&gt; The short formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 15 is: </span></span>
<span><span class="co">#&gt; ESETA1.15 ~ B18Raw.6 + BioDadInHH2 + caregiv_health + CORTB.6 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + ESETA1.6 + gov_assist + HOMEETA1.6 + HomeOwnd + </span></span>
<span><span class="co">#&gt;     IBRAttn.6 + InRatioCor.6 + KFASTScr + MDI.6 + peri_health + </span></span>
<span><span class="co">#&gt;     PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.6 + RHealth + </span></span>
<span><span class="co">#&gt;     RMomAgeU + SAAmylase.6 + SmokTotl + state + SurpPreg + SWghtLB + </span></span>
<span><span class="co">#&gt;     TcBlac2 + WndNbrhood.6</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e796de550&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the short balancing formula below that includes time-varying confounders at t-1 only:</span></span>
<span><span class="co">#&gt; The short formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 24 is: </span></span>
<span><span class="co">#&gt; ESETA1.24 ~ B18Raw.15 + BioDadInHH2 + caregiv_health + CORTB.15 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + ESETA1.15 + gov_assist + HOMEETA1.15 + HomeOwnd + </span></span>
<span><span class="co">#&gt;     IBRAttn.15 + InRatioCor.15 + KFASTScr + MDI.15 + peri_health + </span></span>
<span><span class="co">#&gt;     PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.15 + RHealth + </span></span>
<span><span class="co">#&gt;     RMomAgeU + SAAmylase.15 + SmokTotl + state + SurpPreg + SWghtLB + </span></span>
<span><span class="co">#&gt;     TcBlac2</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e796de550&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the short balancing formula below that includes time-varying confounders at t-1 only:</span></span>
<span><span class="co">#&gt; The short formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 35 is: </span></span>
<span><span class="co">#&gt; ESETA1.35 ~ B18Raw.24 + BioDadInHH2 + caregiv_health + CORTB.24 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + EARS_TJo.24 + ESETA1.24 + gov_assist + HOMEETA1.24 + </span></span>
<span><span class="co">#&gt;     HomeOwnd + IBRAttn.24 + InRatioCor.24 + KFASTScr + LESMnNeg.24 + </span></span>
<span><span class="co">#&gt;     LESMnPos.24 + peri_health + PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + </span></span>
<span><span class="co">#&gt;     RHasSO.24 + RHealth + RMomAgeU + SAAmylase.24 + SmokTotl + </span></span>
<span><span class="co">#&gt;     state + SurpPreg + SWghtLB + TcBlac2 + WndNbrhood.24</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e796de550&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the short balancing formula below that includes time-varying confounders at t-1 only:</span></span>
<span><span class="co">#&gt; The short formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 58 is: </span></span>
<span><span class="co">#&gt; ESETA1.58 ~ BioDadInHH2 + caregiv_health + DrnkFreq + EARS_TJo.35 + </span></span>
<span><span class="co">#&gt;     ESETA1.35 + fscore.35 + gov_assist + HOMEETA1.35 + HomeOwnd + </span></span>
<span><span class="co">#&gt;     InRatioCor.35 + KFASTScr + LESMnNeg.35 + LESMnPos.35 + peri_health + </span></span>
<span><span class="co">#&gt;     PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.35 + RHealth + </span></span>
<span><span class="co">#&gt;     RMomAgeU + SmokTotl + state + StrDif_Tot.35 + SurpPreg + </span></span>
<span><span class="co">#&gt;     SWghtLB + TcBlac2 + WndNbrhood.35</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556e796de550&gt;</span></span></code></pre></div>
<p>Above, we inspect the shortened balancing formula at each exposure
time point. These formulas are considerably shorter than the full
formulas. For instance, at the 58-month exposure time point, the formula
contains all time invariant confounders and only time-varying
confounders at the 35-month time point.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="b--create-iptw-balancing-weights-using-multiple-weighting-methods">2b. Create IPTW Balancing Weights using Multiple Weighting
Methods<a class="anchor" aria-label="anchor" href="#b--create-iptw-balancing-weights-using-multiple-weighting-methods"></a>
</h4>
<p>Having created shorter, simplified balancing formulas, we now create
the first round of IPTW balancing weights (Thoemmes &amp; Ong, 2016)
using the <code><a href="../reference/createWeights.html">createWeights()</a></code> function, the shortened balancing
formulas, and all available weighting methods. The function calls the
<code>weightitMSM()</code> function from the <em>WeightIt</em> package
(Greifer, 2023) that uses the time-specific formulas to create weights
at each time point before automatically multiplying them together to
create one weight per person. Weights are stabilized, as recommended
(Cole &amp; Hernan, 2008; Thoemmes &amp; Ong, 2016), and distributions
are saved for inspection.</p>
<p>The required inputs for using the <code><a href="../reference/createWeights.html">createWeights()</a></code>
function to create the initial around of IPTW balancing weights are:
complete data (data frame, mids object, or a list of imputed datasets as
dataframes in wide format), exposure (e.g., “variable”), outcome (e.g.,
“variable.t”), and the short formulas (see Step 2a).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="va">short_formulas</span></span></code></pre></div>
<p>The optional inputs are as follows.</p>
<p>For <code>method</code>, provide one of the following methods for
calculating balancing weights using <code>weightitMSM()</code> from the
methods that have been validated for longitudinal exposures: “cbps”
(Covariate Balancing Propensity Score weighting; default), “gbm”
(generalized boosted model), “glm” (generalized linear model), or
“super” (SuperLearner via the <em>SuperLearner</em> package; Polley et
al., 2013). More information can be found in the
<a href="(https://ngreifer.github.io/WeightIt/reference/weightitMSM.html" class="external-link"><em>WeightIt</em>
documentation</a>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"cbps"</span></span></code></pre></div>
<p>The <code><a href="../reference/createWeights.html">createWeights()</a></code> function can also take any number of
additional arguments that will be passed to the
<code>weightitMSM ()</code> function (e.g., ‘criterion’, distribution’,
‘SL.library’). If the user selects the SuperLearner (“super”) method,
the default super learner library (‘SL.library’) is xx but an
alternative library can be entered as an input to the
<code>createWeights</code> function. For binary exposures, the “cbps”
method allows you to specify <code>estimand</code> as either ATE, ATT,
or ATC. With “glm”, “super”, and “bart” you can specify ATE, ATT, ATC,
ATO, ATM, or ATOS. With “gbm”, you can specify ATE, ATT, ATC, ATO, or
ATM. The default estimand for binary exposures is ATE. We advise the
interested user to review the
<a href="(https://ngreifer.github.io/WeightIt/reference/weightitMSM.html" class="external-link"><em>WeightIt</em>
documentation</a> for more information about the additional optional
arguments available for each of the weighting methods.</p>
<p>The user can also specify <code>read_in_from_file = TRUE</code>if the
user has previously created weights for these specific data, formula,
and weight type using this function and wishes to read them in from a
local file instead of recreating them. The <code><a href="../reference/createWeights.html">createWeights()</a></code>
function automatically conducts some basic checks that the saved weights
match the data type, weights method, and number of formulas provided.
The user is responsible for making sure these weights were created
appropriately.</p>
<p>The <code><a href="../reference/createWeights.html">createWeights()</a></code> function saves out an .rds file of
the weights in the ‘weights’ folder, a histogram of the weights
distribution in the ‘weights/histograms/’ folder, and a .csv file of
data with the weights appended in the ‘weights/values/’ folder.</p>
<p>The function returns a list of weights objects each in the form of
WeightItMSM output in a single nested list (labeled “0” if data are in
data frame format) or with nested lists for each imputed dataset (if
data are imputed).</p>
<div class="section level5">
<h5 id="cbps">CBPS<a class="anchor" aria-label="anchor" href="#cbps"></a>
</h5>
<p>Below, we create IPTW weights using the default CBPS method.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights.cbps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createWeights.html">createWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                              method <span class="op">=</span> <span class="va">method</span>, read_in_from_file <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co">#optional</span></span>
<span>                              home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span>  <span class="co">#optional</span></span>
<span><span class="co">#&gt; For imputation 1 and the cbps weighting method, the median weight value is 1.1 (SD= 5.16; range= 0-132.54).</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; For imputation 2 and the cbps weighting method, the median weight value is 1.13 (SD= 3.78; range= 0-53.27).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<p>As shown above, the distribution has a heavy right tail (typical of
real-world data), and a median value of 1.21. The right tail of the
distribution represents individuals who experienced statistically
unexpected levels of exposure given their levels of confounders.</p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="glm">GLM<a class="anchor" aria-label="anchor" href="#glm"></a>
</h5>
<p>We then create IPTW balancing weights using all other available
methods in order to evaluate and compare their performance in subsequent
steps.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"glm"</span></span>
<span></span>
<span><span class="va">weights.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createWeights.html">createWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                             method <span class="op">=</span> <span class="va">method</span>, read_in_from_file <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#optional</span></span>
<span>                             home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span>  <span class="co">#optional</span></span>
<span><span class="co">#&gt; For imputation 1 and the glm weighting method, the median weight value is 0.87 (SD= 1.87; range= 0.03-31.24).</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; For imputation 2 and the glm weighting method, the median weight value is 0.88 (SD= 1.64; range= 0.02-21.02).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-18-2.png" width="700"></p>
<p>As shown above, the GLM method produces a similar distribution of
weights.</p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="gbm">GBM<a class="anchor" aria-label="anchor" href="#gbm"></a>
</h5>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"gbm"</span></span>
<span></span>
<span><span class="va">weights.gbm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createWeights.html">createWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                             method <span class="op">=</span> <span class="va">method</span>, read_in_from_file <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co">#optional</span></span>
<span>                             home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span>  <span class="co">#optional</span></span>
<span><span class="co">#&gt; For imputation 1 and the gbm weighting method, the median weight value is 0.47 (SD= 0.91; range= 0.01-17.27).</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; For imputation 2 and the gbm weighting method, the median weight value is 0.48 (SD= 1.34; range= 0-34.87).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-19-2.png" width="700"></p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="bart">Bart<a class="anchor" aria-label="anchor" href="#bart"></a>
</h5>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"bart"</span></span>
<span></span>
<span><span class="va">weights.bart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createWeights.html">createWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                              method <span class="op">=</span> <span class="va">method</span>, read_in_from_file <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#optional</span></span>
<span>                              home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; For imputation 1 and the bart weighting method, the median weight value is 0.7 (SD= 1.69; range= 0.04-33.74).</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; For imputation 2 and the bart weighting method, the median weight value is 0.69 (SD= 1.47; range= 0.03-21.5).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-20-2.png" width="700"></p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="super">Super<a class="anchor" aria-label="anchor" href="#super"></a>
</h5>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"super"</span></span>
<span></span>
<span><span class="va">weights.super</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createWeights.html">createWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                               method <span class="op">=</span> <span class="va">method</span>, read_in_from_file <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Loading required package: nnls</span></span>
<span><span class="co">#&gt; For imputation 1 and the super weighting method, the median weight value is 0.97 (SD= 2.34; range= 0.02-36.66).</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; For imputation 2 and the super weighting method, the median weight value is 0.98 (SD= 1.97; range= 0.02-32.62).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-21-2.png" width="700"></p>
<p><br></p>
</div>
</div>
<div class="section level4">
<h4 id="c--assess-all-weighting-methods-to-determine-optimal-method">2c. Assess All Weighting Methods to Determine Optimal Method<a class="anchor" aria-label="anchor" href="#c--assess-all-weighting-methods-to-determine-optimal-method"></a>
</h4>
<p>Next, we evaluate how well the weights created using each of the
different weighting methods reduced imbalance for the confounders that
we provided in the short balancing formula, using the
<code><a href="../reference/assessBalance.html">assessBalance()</a></code> function (<code>type = “weighted”</code>).
This function calls the <code><a href="../reference/calcBalStats.html">calcBalStats()</a></code> function using the
short formulas and specifies that the balance statistics should be
calculated using the IPTW weights supplied.</p>
<p>The <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function outputs balance statistics
(correlations for continuous exposures and standardized mean differences
for binary exposures) relating exposure at each time point to
confounders in a table as well as in plots. This function also provides
summary balance statistics averaging across all time points (and imputed
datasets if they are supplied).</p>
<p>The required inputs for using the <code><a href="../reference/assessBalance.html">assessBalance()</a></code>
function to assess balance for the first round of IPTW weights are:
complete data (data frame, mids object, or a list of imputed datasets as
dataframes in wide format), exposure (e.g., “variable”), exposure time
points, outcome (e.g., “variable.t”), providing the short formulas (see
Step 2a), setting <code>type = “weighted”</code>, and providing the
weights that were just created.</p>
<p>The optional inputs are described in Step 1b.</p>
<p>The <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function saves out the following
.csv and .html files into the ‘balance/weighted/’ folder: tables of
balance statistics for all confounders, tables of balance statistics for
covariates that are imbalanced, and an overall balance summary table
(averaged across any imputed datasets). Within the
‘balance/weighted/plots/’ folder, the function outputs .jpeg files of
summary love plots depicting confounder balance for each exposure time
point.</p>
<p>The function returns a data frame (or list) of balance statistics,
balance thresholds, and binary balanced tag (1 = balanced, 0 =
imbalanced) for each confounder relevant to each exposure time
point.</p>
<div class="section level5">
<h5 id="cbps-1">CBPS<a class="anchor" aria-label="anchor" href="#cbps-1"></a>
</h5>
<p>We first assess balance for the CBPS weighting method.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"weighted"</span></span>
<span></span>
<span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="va">short_formulas</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights.cbps</span> </span>
<span></span>
<span><span class="va">balance_stats.cbps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                    outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                    balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                    home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using short formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using cbps and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.04 (range = -0.29 - 0.18).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 19 out of 131 (15%) covariates across time points, corresponding to 14 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.13 (range= -0.29-0.18):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using cbps and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|          9|            9| 18|</span></span>
<span><span class="co">#&gt; |       15|         27|            1| 28|</span></span>
<span><span class="co">#&gt; |       24|         24|            3| 27|</span></span>
<span><span class="co">#&gt; |       35|         30|            0| 30|</span></span>
<span><span class="co">#&gt; |       58|         22|            6| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using cbps and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.12 - 0.12).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 7 out of 131 (5%) covariates across time points, corresponding to 4 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.09 (range= -0.12-0.12):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using cbps and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         26|            1| 27|</span></span>
<span><span class="co">#&gt; |       35|         29|            1| 30|</span></span>
<span><span class="co">#&gt; |       58|         26|            2| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-22-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the short formulas and cbps :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.16-0.13).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 11 covariates across time points out of 131 total (8.4%) spanning 9 domains out of 33 (27.27%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.11 (range=-0.16-0.13) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |4   |ESETA1   |        6|          0|peri_health   | -0.1592749|       0.10|        0|</span></span>
<span><span class="co">#&gt; |5   |ESETA1   |        6|          0|PmAge2        |  0.1086703|       0.10|        0|</span></span>
<span><span class="co">#&gt; |8   |ESETA1   |        6|          0|SWghtLB       | -0.1528902|       0.10|        0|</span></span>
<span><span class="co">#&gt; |9   |ESETA1   |        6|          0|BioDadInHH2   | -0.1256286|       0.10|        0|</span></span>
<span><span class="co">#&gt; |12  |ESETA1   |        6|          0|PmBlac2       |  0.1156135|       0.10|        0|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.1254056|       0.10|        0|</span></span>
<span><span class="co">#&gt; |26  |ESETA1   |       15|          6|InRatioCor.6  |  0.0597502|       0.05|        0|</span></span>
<span><span class="co">#&gt; |31  |ESETA1   |       15|          0|PmEd2         |  0.0618480|       0.05|        0|</span></span>
<span><span class="co">#&gt; |110 |ESETA1   |       58|         35|InRatioCor.35 | -0.0734350|       0.05|        0|</span></span>
<span><span class="co">#&gt; |120 |ESETA1   |       58|         35|WndNbrhood.35 |  0.1135458|       0.10|        0|</span></span>
<span><span class="co">#&gt; |124 |ESETA1   |       58|          0|PmBlac2       |  0.1008793|       0.10|        0|</span></span></code></pre>
<p>As shown above, for the”CBPS weighting method and short formulas, the
median absolute value correlation between confounder and exposure is
0.03 and only 8 confounders remain imbalanced.</p>
<p><br> ##### GLM</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights.glm</span></span>
<span></span>
<span><span class="va">balance_stats.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                   outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                   balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                   home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using short formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using glm and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.11 - 0.21).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 9 out of 131 (7%) covariates across time points, corresponding to 5 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= -0.11-0.21):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using glm and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         23|            5| 28|</span></span>
<span><span class="co">#&gt; |       24|         26|            1| 27|</span></span>
<span><span class="co">#&gt; |       35|         29|            1| 30|</span></span>
<span><span class="co">#&gt; |       58|         26|            2| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using glm and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.1 - 0.18).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 7 out of 131 (5%) covariates across time points, corresponding to 5 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.1 (range= -0.1-0.18):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using glm and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         26|            1| 27|</span></span>
<span><span class="co">#&gt; |       35|         27|            3| 30|</span></span>
<span><span class="co">#&gt; |       58|         28|            0| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-23-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the short formulas and glm :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.09-0.19).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 5 covariates across time points out of 131 total (3.82%) spanning 3 domains out of 33 (9.09%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.07 (range=-0.07-0.19) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.1924824|       0.10|        0|</span></span>
<span><span class="co">#&gt; |26  |ESETA1   |       15|          6|InRatioCor.6  | -0.0532444|       0.05|        0|</span></span>
<span><span class="co">#&gt; |32  |ESETA1   |       15|          0|RMomAgeU      |  0.1073611|       0.10|        0|</span></span>
<span><span class="co">#&gt; |82  |ESETA1   |       35|         24|InRatioCor.24 | -0.0713477|       0.05|        0|</span></span>
<span><span class="co">#&gt; |110 |ESETA1   |       58|         35|InRatioCor.35 | -0.0616115|       0.05|        0|</span></span></code></pre>
<p>For the GLM weighting method, the median absolute value correlation
between exposure and confounders is 0.02, with only 6 confounders
remaining imbalanced.</p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="glm-1">GLM<a class="anchor" aria-label="anchor" href="#glm-1"></a>
</h5>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights.gbm</span></span>
<span></span>
<span><span class="va">balance_stats.gbm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                   outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                   balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                   home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using short formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using gbm and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.06 - 0.14).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 6 out of 131 (5%) covariates across time points, corresponding to 3 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.06 (range= -0.06-0.14):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using gbm and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         27|            1| 28|</span></span>
<span><span class="co">#&gt; |       24|         24|            3| 27|</span></span>
<span><span class="co">#&gt; |       35|         29|            1| 30|</span></span>
<span><span class="co">#&gt; |       58|         27|            1| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using gbm and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.11 - 0.18).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 14 out of 131 (11%) covariates across time points, corresponding to 10 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= -0.11-0.18):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using gbm and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         16|            2| 18|</span></span>
<span><span class="co">#&gt; |       15|         23|            5| 28|</span></span>
<span><span class="co">#&gt; |       24|         21|            6| 27|</span></span>
<span><span class="co">#&gt; |       35|         29|            1| 30|</span></span>
<span><span class="co">#&gt; |       58|         28|            0| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-24-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the short formulas and gbm :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.07-0.16).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 5 covariates across time points out of 131 total (3.82%) spanning 4 domains out of 33 (12.12%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.11 (range=-0.07-0.16) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |   |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:--|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |22 |ESETA1   |       15|          6|ESETA1.6      |  0.1621682|       0.10|        0|</span></span>
<span><span class="co">#&gt; |47 |ESETA1   |       24|         15|B18Raw.15     |  0.1134461|       0.10|        0|</span></span>
<span><span class="co">#&gt; |50 |ESETA1   |       24|         15|ESETA1.15     |  0.1146912|       0.10|        0|</span></span>
<span><span class="co">#&gt; |54 |ESETA1   |       24|         15|InRatioCor.15 | -0.0583058|       0.05|        0|</span></span>
<span><span class="co">#&gt; |59 |ESETA1   |       24|          0|PmEd2         | -0.0661572|       0.05|        0|</span></span></code></pre>
<p>For the GBM weighting method, the absolute median correlation between
exposure and confounders is 0.02, with 9 confounders remaining
imbalanced.</p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="bart-1">Bart<a class="anchor" aria-label="anchor" href="#bart-1"></a>
</h5>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights.bart</span></span>
<span></span>
<span><span class="va">balance_stats.bart</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                    outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                    balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                    home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using short formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using bart and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.1 - 0.2).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 10 out of 131 (8%) covariates across time points, corresponding to 4 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= -0.1-0.2):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using bart and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         26|            2| 28|</span></span>
<span><span class="co">#&gt; |       24|         24|            3| 27|</span></span>
<span><span class="co">#&gt; |       35|         28|            2| 30|</span></span>
<span><span class="co">#&gt; |       58|         25|            3| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using bart and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.09 - 0.22).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 9 out of 131 (7%) covariates across time points, corresponding to 5 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.1 (range= -0.08-0.22):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using bart and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         17|            1| 18|</span></span>
<span><span class="co">#&gt; |       15|         27|            1| 28|</span></span>
<span><span class="co">#&gt; |       24|         23|            4| 27|</span></span>
<span><span class="co">#&gt; |       35|         28|            2| 30|</span></span>
<span><span class="co">#&gt; |       58|         27|            1| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-25-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the short formulas and bart :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.09-0.21).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 8 covariates across time points out of 131 total (6.11%) spanning 3 domains out of 33 (9.09%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.11 (range=-0.08-0.21) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.2084686|       0.10|        0|</span></span>
<span><span class="co">#&gt; |47  |ESETA1   |       24|         15|B18Raw.15     |  0.1174755|       0.10|        0|</span></span>
<span><span class="co">#&gt; |50  |ESETA1   |       24|         15|ESETA1.15     |  0.1359561|       0.10|        0|</span></span>
<span><span class="co">#&gt; |54  |ESETA1   |       24|         15|InRatioCor.15 | -0.0690721|       0.05|        0|</span></span>
<span><span class="co">#&gt; |78  |ESETA1   |       35|         24|ESETA1.24     |  0.1238527|       0.10|        0|</span></span>
<span><span class="co">#&gt; |82  |ESETA1   |       35|         24|InRatioCor.24 | -0.0834063|       0.05|        0|</span></span>
<span><span class="co">#&gt; |106 |ESETA1   |       58|         35|ESETA1.35     |  0.1123522|       0.10|        0|</span></span>
<span><span class="co">#&gt; |110 |ESETA1   |       58|         35|InRatioCor.35 | -0.0587741|       0.05|        0|</span></span></code></pre>
<p>For the BART weighting method, the median absolute value correlation
between exposure and confounder is 0.02, with 11 confounders remaining
imbalanced.</p>
<p><br></p>
</div>
<div class="section level5">
<h5 id="super-1">Super<a class="anchor" aria-label="anchor" href="#super-1"></a>
</h5>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights.super</span> </span>
<span></span>
<span><span class="va">balance_stats.super</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                     outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                     balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                     home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using short formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using super and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.1 - 0.2).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 9 out of 131 (7%) covariates across time points, corresponding to 6 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= -0.1-0.2):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using super and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         17|            1| 18|</span></span>
<span><span class="co">#&gt; |       15|         23|            5| 28|</span></span>
<span><span class="co">#&gt; |       24|         26|            1| 27|</span></span>
<span><span class="co">#&gt; |       35|         30|            0| 30|</span></span>
<span><span class="co">#&gt; |       58|         26|            2| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using super and short formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.08 - 0.18).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 3 out of 131 (2%) covariates across time points, corresponding to 2 out of 32 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= 0.11-0.18):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using super and short formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         27|            1| 28|</span></span>
<span><span class="co">#&gt; |       24|         26|            1| 27|</span></span>
<span><span class="co">#&gt; |       35|         29|            1| 30|</span></span>
<span><span class="co">#&gt; |       58|         28|            0| 28|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-26-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the short formulas and super :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.07-0.19).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 2 covariates across time points out of 131 total (1.53%) spanning 2 domains out of 33 (6.06%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.15 (range=0.1-0.19) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |   |exposure | exp_time| covar_time|covariate |   avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:--|:--------|--------:|----------:|:---------|---------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |7  |ESETA1   |        6|          0|RMomAgeU  | 0.1044811|        0.1|        0|</span></span>
<span><span class="co">#&gt; |22 |ESETA1   |       15|          6|ESETA1.6  | 0.1895853|        0.1|        0|</span></span></code></pre>
<p>For the SuperLearner weighting method, the median absolute value
correlation between exposure and confounder is 0.02, with only 5
confounders remaining imbalanced.</p>
<p><br></p>
<p>The optimal weighting method for a dataset is the method that yields
the best confounder balance. From these iterations, we identify the best
performing weighting method that most reduces the imbalance between
exposure and confounder (as indicated by the lowest absolute value
median correlation) and the fewest number of confounders left
imbalanced.</p>
<p>In this example, we identify SuperLearner as the optimal weighting
method.</p>
<p><br><br></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="step-3-create-updated-formulas-re-specify-weights-using-optimal-weighting-method">Step 3: Create Updated Formulas &amp; Re-Specify Weights Using
Optimal Weighting Method<a class="anchor" aria-label="anchor" href="#step-3-create-updated-formulas-re-specify-weights-using-optimal-weighting-method"></a>
</h3>
<p>The goal of this next step is to assess the best-performing weights
created by the shortened balancing formulas (containing time-varying
confounders at only <em>t</em>-1) relative to the full balancing
formulas, and add to the shortened formulas any time-varying confounders
at lags &gt; <em>t</em>-1 that were not successfully balanced, to create
a final round of weights.</p>
<p><br></p>
<div class="section level4">
<h4 id="step-3a--assess-balance-with-full-balancing-formulas">Step 3a. Assess Balance with Full Balancing Formulas<a class="anchor" aria-label="anchor" href="#step-3a--assess-balance-with-full-balancing-formulas"></a>
</h4>
<p>We next assess whether the weights created in the previous step with
the best-performing weights method (i.e., using the SuperLearner method)
using the simplified balancing formulas also achieve balance with the
full formulas. Here, we revisit our assumption that balancing on the
most proximal time-varying confounders (<em>t</em>-1) confers balance
for those same confounders at more distal prior time points (<em>t</em>-
1+). We do this by assessing at each time point how well the weights
just created using the short formulas successfully balance all
confounders (including time-varying confounders at all time points
prior) in the original, full formulas. We use the
<code><a href="../reference/assessBalance.html">assessBalance()</a></code> function (<code>type = “weighted”</code>)
with the full balancing formulas.</p>
<p>The required inputs for using the <code><a href="../reference/assessBalance.html">assessBalance()</a></code>
function to assess how the best weights achieve balance for the full
formulas are: complete data (data frame, mids object, or a list of
imputed datasets as dataframes in wide format), exposure (e.g.,
“variable”), exposure time points, outcome (e.g., “variable.t”),
providing the full formulas (see Step 1a), setting
<code>type = “weighted”</code>, and providing the best weights (see Step
2c).</p>
<p>The optional inputs are detailed in Step 1b.</p>
<p>The <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function saves out the following
.csv and .html files into the ‘balance/weighted/’ folder: tables of
balance statistics for all confounders, tables of balance statistics for
covariates that are imbalanced, and an overall balance summary table
(averaged across any imputed datasets). Within the ‘balance/type/plots/’
folder, the function outputs .jpeg files of summary love plots depicting
confounder balance for each exposure time point.</p>
<p>The function returns a data frame (or list) of balance statistics,
balance thresholds, and binary balanced tag for each confounder relevant
to each exposure time point.</p>
<p>Below, we assess the weights created using the SuperLearner method
relative to the full balancing formulas.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"weighted"</span></span>
<span></span>
<span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="va">full_formulas</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights.super</span></span>
<span></span>
<span><span class="va">balance_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                               outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                               balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using full formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.1 - 0.21).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 17 out of 191 (9%) covariates across time points, corresponding to 6 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= -0.1-0.21):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         17|            1| 18|</span></span>
<span><span class="co">#&gt; |       15|         23|            5| 28|</span></span>
<span><span class="co">#&gt; |       24|         35|            2| 37|</span></span>
<span><span class="co">#&gt; |       35|         47|            2| 49|</span></span>
<span><span class="co">#&gt; |       58|         52|            7| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.08 - 0.25).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 13 out of 191 (7%) covariates across time points, corresponding to 3 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.11 (range= -0.06-0.25):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         27|            1| 28|</span></span>
<span><span class="co">#&gt; |       24|         33|            4| 37|</span></span>
<span><span class="co">#&gt; |       35|         44|            5| 49|</span></span>
<span><span class="co">#&gt; |       58|         56|            3| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-27-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the full formulas and super :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.07-0.23).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 8 covariates across time points out of 191 total (4.19%) spanning 3 domains out of 33 (9.09%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.14 (range=-0.07-0.23) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |7   |ESETA1   |        6|          0|RMomAgeU      |  0.1044811|       0.10|        0|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.1895853|       0.10|        0|</span></span>
<span><span class="co">#&gt; |53  |ESETA1   |       24|          6|ESETA1.6      |  0.1691291|       0.10|        0|</span></span>
<span><span class="co">#&gt; |60  |ESETA1   |       24|          6|InRatioCor.6  | -0.0501475|       0.05|        0|</span></span>
<span><span class="co">#&gt; |92  |ESETA1   |       35|         15|ESETA1.15     |  0.2265483|       0.10|        0|</span></span>
<span><span class="co">#&gt; |94  |ESETA1   |       35|          6|ESETA1.6      |  0.1655091|       0.10|        0|</span></span>
<span><span class="co">#&gt; |142 |ESETA1   |       58|         15|ESETA1.15     |  0.1190399|       0.10|        0|</span></span>
<span><span class="co">#&gt; |155 |ESETA1   |       58|         15|InRatioCor.15 | -0.0671395|       0.05|        0|</span></span></code></pre>
<p>As shown above, using the SuperLearner weighting method and the full
formulas, we find a median absolute value correlation between exposure
and confounder of 0.03 and a total of 13 confounders remaining
imbalanced.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="step-3b--update-simplified-formulas">Step 3b. Update Simplified Formulas<a class="anchor" aria-label="anchor" href="#step-3b--update-simplified-formulas"></a>
</h4>
<p>Subsequently, we update the shortened formulas to include any
time-varying confounders (<em>t</em>-1 +) that were not successfully
balanced by the full formulas, as shown above. To do this, we create a
final round of balancing formulas using the
<code><a href="../reference/createFormulas.html">createFormulas()</a></code> function (setting
<code>type = “update"</code> and providing the balance statistics of the
<code>bal_stats</code> field). The <code><a href="../reference/createFormulas.html">createFormulas()</a></code>
function draws from user-provided balance statistics to automatically
identify and add to the formulas at each exposure time point any
time-varying confounders at lags greater than 1 that remain imbalanced
after weighting. The function displays each balancing formula in the
console with a message to the user about any time-varying confounders
that were added.</p>
<p>The required input to update the shortened balancing formulas using
the <code><a href="../reference/createFormulas.html">createFormulas()</a></code> function are: exposure (e.g.,
“variable”), exposure time points, outcome (e.g., “variable.t”), a list
of time-varying confounders (e.g., “variable.time”), a list of time
invariant confounders (e.g., “variable”), setting
<code>type = “update”</code>, and providing to <code>bal_stats</code>
the balance statistics that were just created in Step 3a.</p>
<p>The optional input are detailed in Step 1a.</p>
<p>The <code><a href="../reference/createFormulas.html">createFormulas()</a></code> function saves out .csv and .rds
files containing balancing formulas at each exposure time point for the
specified type in the ‘formulas/update/’ folder.</p>
<p>The function returns a list of balancing formulas labeled by type,
exposure, outcome, and exposure time point.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"update"</span></span>
<span></span>
<span><span class="va">bal_stats</span> <span class="op">&lt;-</span> <span class="va">balance_stats</span></span>
<span></span>
<span><span class="va">updated_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createFormulas.html">createFormulas</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, <span class="co">#required</span></span>
<span>                                   type <span class="op">=</span> <span class="va">type</span>, ti_confounders <span class="op">=</span> <span class="va">ti_confounders</span>, tv_confounders <span class="op">=</span> <span class="va">tv_confounders</span>, bal_stats <span class="op">=</span> <span class="va">bal_stats</span>, <span class="co">#required</span></span>
<span>                                   concur_conf <span class="op">=</span> <span class="va">concur_conf</span>, keep_conf <span class="op">=</span> <span class="va">keep_conf</span>, <span class="co">#optional</span></span>
<span>                                   home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the updated balancing formula below that includes time-varying confounders at t-1 and those greater at further lags that remained imbalanced:</span></span>
<span><span class="co">#&gt; The update formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 6 is: </span></span>
<span><span class="co">#&gt; ESETA1.6 ~ BioDadInHH2 + caregiv_health + DrnkFreq + gov_assist + </span></span>
<span><span class="co">#&gt;     HomeOwnd + KFASTScr + peri_health + PmAge2 + PmBlac2 + PmEd2 + </span></span>
<span><span class="co">#&gt;     PmMrSt2 + RHealth + RMomAgeU + SmokTotl + state + SurpPreg + </span></span>
<span><span class="co">#&gt;     SWghtLB + TcBlac2</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556eb47c6e30&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the updated balancing formula below that includes time-varying confounders at t-1 and those greater at further lags that remained imbalanced:</span></span>
<span><span class="co">#&gt; For ESETA1 at exposure time point 15 no time-varying confounders at additional lags were added. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The update formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 15 is: </span></span>
<span><span class="co">#&gt; ESETA1.15 ~ B18Raw.6 + BioDadInHH2 + caregiv_health + CORTB.6 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + ESETA1.6 + gov_assist + HOMEETA1.6 + HomeOwnd + </span></span>
<span><span class="co">#&gt;     IBRAttn.6 + InRatioCor.6 + KFASTScr + MDI.6 + peri_health + </span></span>
<span><span class="co">#&gt;     PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.6 + RHealth + </span></span>
<span><span class="co">#&gt;     RMomAgeU + SAAmylase.6 + SmokTotl + state + SurpPreg + SWghtLB + </span></span>
<span><span class="co">#&gt;     TcBlac2 + WndNbrhood.6</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556eb47c6e30&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the updated balancing formula below that includes time-varying confounders at t-1 and those greater at further lags that remained imbalanced:</span></span>
<span><span class="co">#&gt; For ESETA1 at exposure time point 24 the following covariate(s) will be added to the short balancing formula:</span></span>
<span><span class="co">#&gt;                           ESETA1.6, InRatioCor.6 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The update formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 24 is: </span></span>
<span><span class="co">#&gt; ESETA1.24 ~ B18Raw.15 + BioDadInHH2 + caregiv_health + CORTB.15 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + ESETA1.15 + ESETA1.6 + gov_assist + HOMEETA1.15 + </span></span>
<span><span class="co">#&gt;     HomeOwnd + IBRAttn.15 + InRatioCor.15 + InRatioCor.6 + KFASTScr + </span></span>
<span><span class="co">#&gt;     MDI.15 + peri_health + PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + </span></span>
<span><span class="co">#&gt;     RHasSO.15 + RHealth + RMomAgeU + SAAmylase.15 + SmokTotl + </span></span>
<span><span class="co">#&gt;     state + SurpPreg + SWghtLB + TcBlac2</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556eb47c6e30&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the updated balancing formula below that includes time-varying confounders at t-1 and those greater at further lags that remained imbalanced:</span></span>
<span><span class="co">#&gt; For ESETA1 at exposure time point 35 the following covariate(s) will be added to the short balancing formula:</span></span>
<span><span class="co">#&gt;                           ESETA1.15, ESETA1.6 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The update formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 35 is: </span></span>
<span><span class="co">#&gt; ESETA1.35 ~ B18Raw.24 + BioDadInHH2 + caregiv_health + CORTB.24 + </span></span>
<span><span class="co">#&gt;     DrnkFreq + EARS_TJo.24 + ESETA1.15 + ESETA1.24 + ESETA1.6 + </span></span>
<span><span class="co">#&gt;     gov_assist + HOMEETA1.24 + HomeOwnd + IBRAttn.24 + InRatioCor.24 + </span></span>
<span><span class="co">#&gt;     KFASTScr + LESMnNeg.24 + LESMnPos.24 + peri_health + PmAge2 + </span></span>
<span><span class="co">#&gt;     PmBlac2 + PmEd2 + PmMrSt2 + RHasSO.24 + RHealth + RMomAgeU + </span></span>
<span><span class="co">#&gt;     SAAmylase.24 + SmokTotl + state + SurpPreg + SWghtLB + TcBlac2 + </span></span>
<span><span class="co">#&gt;     WndNbrhood.24</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556eb47c6e30&gt;</span></span>
<span><span class="co">#&gt; USER ALERT: Please manually inspect the updated balancing formula below that includes time-varying confounders at t-1 and those greater at further lags that remained imbalanced:</span></span>
<span><span class="co">#&gt; For ESETA1 at exposure time point 58 the following covariate(s) will be added to the short balancing formula:</span></span>
<span><span class="co">#&gt;                           ESETA1.15, InRatioCor.15 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The update formula for ESETA1 - StrDif_Tot.58 at ESETA1 time point 58 is: </span></span>
<span><span class="co">#&gt; ESETA1.58 ~ BioDadInHH2 + caregiv_health + DrnkFreq + EARS_TJo.35 + </span></span>
<span><span class="co">#&gt;     ESETA1.15 + ESETA1.35 + fscore.35 + gov_assist + HOMEETA1.35 + </span></span>
<span><span class="co">#&gt;     HomeOwnd + InRatioCor.15 + InRatioCor.35 + KFASTScr + LESMnNeg.35 + </span></span>
<span><span class="co">#&gt;     LESMnPos.35 + peri_health + PmAge2 + PmBlac2 + PmEd2 + PmMrSt2 + </span></span>
<span><span class="co">#&gt;     RHasSO.35 + RHealth + RMomAgeU + SmokTotl + state + StrDif_Tot.35 + </span></span>
<span><span class="co">#&gt;     SurpPreg + SWghtLB + TcBlac2 + WndNbrhood.35</span></span>
<span><span class="co">#&gt; &lt;environment: 0x556eb47c6e30&gt;</span></span></code></pre></div>
<p>As shown above, several imbalanced confounders at lags greater than
<em>t</em>-1 were added to the short formulas at exposure time points
35-58. For instance, at the 35-month time point, economic strain at 6
and 15 months as well as attention problems and income at 6 months were
added to the balancing formula.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="step-3c--create-final-balancing-weights">Step 3c. Create Final Balancing Weights<a class="anchor" aria-label="anchor" href="#step-3c--create-final-balancing-weights"></a>
</h4>
<p>Next, we create a final set of balancing weights using the optimal
weighting method identified in Step 2c and the final, updated simplified
formulas from the previous step using the <code><a href="../reference/createWeights.html">createWeights()</a></code>
function (<code>method = “super’</code>), with the SuperLearner method
being the optimal weighting method identified in Step 2c. The function
calls the <code>weightitMSM()</code> function from the <em>WeightIt</em>
package (Greifer, 2023) that uses the time-specific formulas to create
weights at each time point before automatically multiplying them
together to create one weight per person. Weights are stabilized, as is
recommended (Cole &amp; Hernan, 2008; Thoemmes &amp; Ong, 2016) and
distributions are saved out in the home directory for inspection.</p>
<p>The required inputs for using the <code><a href="../reference/createWeights.html">createWeights()</a></code>
function to create the final round of IPTW balancing weights using the
updated short balancing formulas are: complete data (data frame, mids
object, or a list of imputed datasets as dataframes in wide format),
exposure (variable with no time points), outcome (e.g.,
“variable.time”), the best-performing weights method, and the updated
formulas (see Step 3a).</p>
<p>The optional input for the <code><a href="../reference/createWeights.html">createWeights()</a></code> function are
listed in Step 2b.</p>
<p>The <code><a href="../reference/createWeights.html">createWeights()</a></code> function saves out an .rds file of
the weights in the ‘weights/’ folder, a histogram of the weights
distribution in the ‘weights/histograms/’ folder, and a .csv file of
data with the weights appended in the ‘weights/values/’ folder.</p>
<p>The function returns a list of weights objects each in the form of
WeightItMSM output a list of weights with either a single nested list
(labeled “0” if data are in data frame format) or with nested lists for
each imputed dataset (if data are imputed).</p>
<p>Below, we use the updated formulas and the SuperLearner weighting
method to create a new round of IPTW balancing weights.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="va">updated_formulas</span></span>
<span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="st">"super"</span></span>
<span></span>
<span><span class="co">#all inputs</span></span>
<span><span class="va">final_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createWeights.html">createWeights</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, <span class="co">#required</span></span>
<span>                               method <span class="op">=</span> <span class="va">method</span>, read_in_from_file <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; For imputation 1 and the super weighting method, the median weight value is 1.02 (SD= 1.21; range= 0.02-20.33).</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; For imputation 2 and the super weighting method, the median weight value is 1.01 (SD= 1.01; range= 0.02-13.24).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-29-2.png" width="700"></p>
<p>As shown above, these weights have a median value of 1 and a heavy
right tail.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="d--trim-final-balancing-weights">3d. Trim Final Balancing Weights<a class="anchor" aria-label="anchor" href="#d--trim-final-balancing-weights"></a>
</h4>
<p>The next step is to trim or winsorize this final set of weights to
eliminate the heavy right tail of its distribution using the
<code><a href="../reference/trimWeights.html">trimWeights()</a></code> function. This function draws on the
<em>Weightit</em> package (Griefer, 2023) and plots and summarizes
trimmed weights. This function outputs a list of trimmed weights with
either a single nested list (labeled “0” if data are in data frame
format) or with nested lists for each imputed dataset (if data are
imputed).</p>
<p>The required inputs for the <code><a href="../reference/trimWeights.html">trimWeights()</a></code> function are:
the exposure (variable with no time points), outcome (e.g.,
“variable.t”), and the final weights we just created.</p>
<p>The optional input allows the user to specify a quantile value (0-1;
default is 0.95) above which the weights will be replaced with the
weight value of that quantile to reduce the heavy right tail.</p>
<p>Below, we use the default 95th percentile for trimming weights.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quantile</span> <span class="op">&lt;-</span> <span class="fl">0.95</span> </span></code></pre></div>
<p>The <code><a href="../reference/trimWeights.html">trimWeights()</a></code> function saves out an .rds file of
trimmed weights in the ‘weights/values/’ folder and a histogram of
trimmed weights in the ‘weights/histograms/’ folder.</p>
<p>The function returns a list of weights objects, containing trimmed
weights, each in the form of weightitMSM output.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">final_weights</span></span>
<span></span>
<span><span class="va">trim_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trimWeights.html">trimWeights</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                            quantile <span class="op">=</span> <span class="va">quantile</span>, <span class="co">#optional</span></span>
<span>                            home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Trimming weights to 95%.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For imputation 1 and the ESETA1-StrDif_Tot.58 relation, following trimming at the 0.95 quantile, the median weight value is 1.02 (SD= 0.63; range= 0.02-3).</span></span>
<span><span class="co">#&gt; Trimming weights to 95%.</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For imputation 2 and the ESETA1-StrDif_Tot.58 relation, following trimming at the 0.95 quantile, the median weight value is 1.01 (SD= 0.64; range= 0.02-3).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-31-2.png" width="700"></p>
<p>As shown above, the weights still have a median value of 1 but a much
shorter right tail.</p>
<p><br></p>
<p>We then create trimmed weights using two other quantile values at +
/- ~0.3 of the previously chosen quantile value, in order to conduct the
recommended sensitivity analyses at subsequent steps.</p>
<p>We first create weights at the 92nd quantile value.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quantile</span> <span class="op">&lt;-</span> <span class="fl">0.92</span> </span>
<span></span>
<span><span class="va">trim_weights.s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trimWeights.html">trimWeights</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                               quantile <span class="op">=</span> <span class="va">quantile</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Trimming weights to 92%.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For imputation 1 and the ESETA1-StrDif_Tot.58 relation, following trimming at the 0.92 quantile, the median weight value is 1.02 (SD= 0.55; range= 0.02-2).</span></span>
<span><span class="co">#&gt; Trimming weights to 92%.</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For imputation 2 and the ESETA1-StrDif_Tot.58 relation, following trimming at the 0.92 quantile, the median weight value is 1.01 (SD= 0.56; range= 0.02-2).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
<p>And then at the 98th quantile value.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quantile</span> <span class="op">&lt;-</span> <span class="fl">0.98</span> </span>
<span></span>
<span><span class="va">trim_weights.s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trimWeights.html">trimWeights</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                               quantile <span class="op">=</span> <span class="va">quantile</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Trimming weights to 98%.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For imputation 1 and the ESETA1-StrDif_Tot.58 relation, following trimming at the 0.98 quantile, the median weight value is 1.02 (SD= 0.78; range= 0.02-4).</span></span>
<span><span class="co">#&gt; Trimming weights to 98%.</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; For imputation 2 and the ESETA1-StrDif_Tot.58 relation, following trimming at the 0.98 quantile, the median weight value is 1.01 (SD= 0.76; range= 0.02-4).</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-33-2.png" width="700"></p>
<p>We find comparable descriptive statistics for all sets of weights,
with the upper range value varying by quantile cutoff. We will assess
the consequences of these different ranges in subsequent steps.</p>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="step-4-conduct-final-balance-assessment">Step 4: Conduct Final Balance Assessment<a class="anchor" aria-label="anchor" href="#step-4-conduct-final-balance-assessment"></a>
</h3>
<p>Having created and trimmed the final set of IPTW balancing weights,
the next step is to conduct a final evaluation of how well they reduce
imbalance for all possible confounders. We assess the performance of the
final weights from the previous step using <code><a href="../reference/assessBalance.html">assessBalance()</a></code>
function (<code>type = “weighted”</code>) and the full formulas.</p>
<p>The required inputs for using the <code><a href="../reference/assessBalance.html">assessBalance()</a></code>
function to assess how the final, trimmed weights achieve balance for
the full formulas are: complete data (data frame, mids object, or a list
of imputed datasets as dataframes in wide format), exposure (e.g.,
“variable”), exposure time points, outcome (e.g., “variable.time”), the
full formulas (see Step 1a), set <code>type = “weighted”</code>, and the
final, trimmed weights (see Step 3b).</p>
<p>The optional inputs for the <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function are
detailed in Step 1b.</p>
<p>The <code><a href="../reference/assessBalance.html">assessBalance()</a></code> function saves out the following
.csv and .html files into the ‘balance/weighted/’ folder: tables of
balance statistics for all confounders, tables of balance statistics for
covariates that are imbalanced, and an overall balance summary table
(averaged across any imputed datasets if applicable). Within the
‘balance/weighted/plots/’ folder, the function outputs .jpeg files of
summary love plots depicting confounder balance for each exposure time
point.</p>
<p>The function returns a data frame (or list) of balance statistics,
balance thresholds, and binary balanced tag for each confounder relevant
to each exposure time point.</p>
<p>Below, we assess our final weights using the full formulas.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"weighted"</span></span>
<span></span>
<span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="va">full_formulas</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">trim_weights</span></span>
<span></span>
<span><span class="va">final_balance_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                     outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                     balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                     home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using full formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.11 - 0.15).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 18 out of 191 (9%) covariates across time points, corresponding to 4 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.08 (range= -0.11-0.15):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         16|            2| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         34|            3| 37|</span></span>
<span><span class="co">#&gt; |       35|         43|            6| 49|</span></span>
<span><span class="co">#&gt; |       58|         55|            4| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.1 - 0.13).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 19 out of 191 (10%) covariates across time points, corresponding to 4 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.09 (range= -0.1-0.13):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         17|            1| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         34|            3| 37|</span></span>
<span><span class="co">#&gt; |       35|         41|            8| 49|</span></span>
<span><span class="co">#&gt; |       58|         55|            4| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-34-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the full formulas and super :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.1-0.14).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 19 covariates across time points out of 191 total (9.95%) spanning 4 domains out of 33 (12.12%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.07 (range=-0.1-0.14) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |2   |ESETA1   |        6|          0|gov_assist    |  0.1067102|       0.10|        0|</span></span>
<span><span class="co">#&gt; |6   |ESETA1   |        6|          0|PmEd2         | -0.0680350|       0.05|        0|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.1426141|       0.10|        0|</span></span>
<span><span class="co">#&gt; |26  |ESETA1   |       15|          6|InRatioCor.6  | -0.0997492|       0.05|        0|</span></span>
<span><span class="co">#&gt; |31  |ESETA1   |       15|          0|PmEd2         | -0.0672029|       0.05|        0|</span></span>
<span><span class="co">#&gt; |59  |ESETA1   |       24|         15|InRatioCor.15 | -0.0574546|       0.05|        0|</span></span>
<span><span class="co">#&gt; |60  |ESETA1   |       24|          6|InRatioCor.6  | -0.0673551|       0.05|        0|</span></span>
<span><span class="co">#&gt; |66  |ESETA1   |       24|          0|PmEd2         | -0.0526951|       0.05|        0|</span></span>
<span><span class="co">#&gt; |92  |ESETA1   |       35|         15|ESETA1.15     |  0.1305356|       0.10|        0|</span></span>
<span><span class="co">#&gt; |93  |ESETA1   |       35|         24|ESETA1.24     |  0.1106361|       0.10|        0|</span></span>
<span><span class="co">#&gt; |94  |ESETA1   |       35|          6|ESETA1.6      |  0.1000157|       0.10|        0|</span></span>
<span><span class="co">#&gt; |102 |ESETA1   |       35|         15|InRatioCor.15 | -0.0772845|       0.05|        0|</span></span>
<span><span class="co">#&gt; |103 |ESETA1   |       35|         24|InRatioCor.24 | -0.0904289|       0.05|        0|</span></span>
<span><span class="co">#&gt; |104 |ESETA1   |       35|          6|InRatioCor.6  | -0.0889601|       0.05|        0|</span></span>
<span><span class="co">#&gt; |112 |ESETA1   |       35|          0|PmEd2         | -0.0521316|       0.05|        0|</span></span>
<span><span class="co">#&gt; |155 |ESETA1   |       58|         15|InRatioCor.15 | -0.0624588|       0.05|        0|</span></span>
<span><span class="co">#&gt; |156 |ESETA1   |       58|         24|InRatioCor.24 | -0.0702655|       0.05|        0|</span></span>
<span><span class="co">#&gt; |157 |ESETA1   |       58|         35|InRatioCor.35 | -0.0665666|       0.05|        0|</span></span>
<span><span class="co">#&gt; |158 |ESETA1   |       58|          6|InRatioCor.6  | -0.0644243|       0.05|        0|</span></span></code></pre>
<p><br></p>
<p>From this assessment, we find that confounders across 3 domains
(economic strain, income-to-needs-ratio, and parental education –ones
that we held to a more stringent balancing threshold due to their
theoretical importance as confounders) remain imbalanced at several
exposure time points with a median absolute value correlation of 0.07
(range = -0.09-0.16). The largest remaining correlations between
exposure and confounder are for economic strain and lagged levels of
economic strain, suggesting high stability in this construct over
time.</p>
<p>In the outcome modeling step (Step 5), the user will have the option
to include any any confounders that are time invariant or measured at
the first time point (6 months) that remain imbalanced following this
final balance assessment as covariates.</p>
<p>We inspect the table above and manually list out these imbalanced
confounders and assign them to <code>covariates</code>.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PmEd2"</span>, <span class="st">"ESETA1.6"</span>, <span class="st">"InRatioCor.6"</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>Subsequently, we also assess balance for the weights trimmed at the
two additional quantile values to assess whether the final balance
assessment is sensitive to the trim value.</p>
<p>Importantly, if <code>save.out = TRUE</code>, running these analyses
will overwrite the output from the main history comparison above if the
main output is not renamed or relocated to a new folder first.
Additionally, after running the first sensitivity check, the output from
that check will be overwritten by the second sensitivity check if it is
not renamed or re-located to a new folder first.</p>
<p>We first assess balance for the weights trimmed at the 93rd quantile
value.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">trim_weights.s1</span></span>
<span></span>
<span><span class="va">final_balance_stats.s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                        outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                        balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                        home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using full formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.12 - 0.15).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 21 out of 191 (11%) covariates across time points, corresponding to 4 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.08 (range= -0.12-0.15):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         16|            2| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         32|            5| 37|</span></span>
<span><span class="co">#&gt; |       35|         43|            6| 49|</span></span>
<span><span class="co">#&gt; |       58|         54|            5| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.1 - 0.13).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 19 out of 191 (10%) covariates across time points, corresponding to 5 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.07 (range= -0.1-0.13):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         16|            2| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         33|            4| 37|</span></span>
<span><span class="co">#&gt; |       35|         43|            6| 49|</span></span>
<span><span class="co">#&gt; |       58|         55|            4| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-36-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the full formulas and super :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.11-0.14).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 18 covariates across time points out of 191 total (9.42%) spanning 4 domains out of 33 (12.12%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.08 (range=-0.11-0.14) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |2   |ESETA1   |        6|          0|gov_assist    |  0.1184388|       0.10|        0|</span></span>
<span><span class="co">#&gt; |6   |ESETA1   |        6|          0|PmEd2         | -0.0780317|       0.05|        0|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.1420689|       0.10|        0|</span></span>
<span><span class="co">#&gt; |26  |ESETA1   |       15|          6|InRatioCor.6  | -0.1112839|       0.05|        0|</span></span>
<span><span class="co">#&gt; |31  |ESETA1   |       15|          0|PmEd2         | -0.0764570|       0.05|        0|</span></span>
<span><span class="co">#&gt; |59  |ESETA1   |       24|         15|InRatioCor.15 | -0.0612949|       0.05|        0|</span></span>
<span><span class="co">#&gt; |60  |ESETA1   |       24|          6|InRatioCor.6  | -0.0723784|       0.05|        0|</span></span>
<span><span class="co">#&gt; |66  |ESETA1   |       24|          0|PmEd2         | -0.0571531|       0.05|        0|</span></span>
<span><span class="co">#&gt; |92  |ESETA1   |       35|         15|ESETA1.15     |  0.1272731|       0.10|        0|</span></span>
<span><span class="co">#&gt; |93  |ESETA1   |       35|         24|ESETA1.24     |  0.1099973|       0.10|        0|</span></span>
<span><span class="co">#&gt; |102 |ESETA1   |       35|         15|InRatioCor.15 | -0.0808120|       0.05|        0|</span></span>
<span><span class="co">#&gt; |103 |ESETA1   |       35|         24|InRatioCor.24 | -0.0925763|       0.05|        0|</span></span>
<span><span class="co">#&gt; |104 |ESETA1   |       35|          6|InRatioCor.6  | -0.0899604|       0.05|        0|</span></span>
<span><span class="co">#&gt; |112 |ESETA1   |       35|          0|PmEd2         | -0.0554874|       0.05|        0|</span></span>
<span><span class="co">#&gt; |155 |ESETA1   |       58|         15|InRatioCor.15 | -0.0631653|       0.05|        0|</span></span>
<span><span class="co">#&gt; |156 |ESETA1   |       58|         24|InRatioCor.24 | -0.0724175|       0.05|        0|</span></span>
<span><span class="co">#&gt; |157 |ESETA1   |       58|         35|InRatioCor.35 | -0.0677041|       0.05|        0|</span></span>
<span><span class="co">#&gt; |158 |ESETA1   |       58|          6|InRatioCor.6  | -0.0671627|       0.05|        0|</span></span></code></pre>
<p>From this, we find that the same constructs remain imbalanced to a
similar degree.</p>
<p><br></p>
<p>We next assess balance for the weights trimmed at the 98th quantile
value.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">trim_weights.s2</span></span>
<span></span>
<span><span class="va">final_balance_stats.s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assessBalance.html">assessBalance</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, <span class="co">#required</span></span>
<span>                                        outcome <span class="op">=</span> <span class="va">outcome</span>, type <span class="op">=</span> <span class="va">type</span>, formulas <span class="op">=</span> <span class="va">formulas</span>, weights <span class="op">=</span> <span class="va">weights</span>, <span class="co">#required</span></span>
<span>                                        balance_thresh <span class="op">=</span> <span class="va">balance_thresh</span>, imp_conf <span class="op">=</span> <span class="va">imp_conf</span>, <span class="co">#optional</span></span>
<span>                                        home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; USER ALERT: The following statistics display covariate imbalance at each exposure time point following IPTW weighting, using full formulas.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 1**</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-1.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-2.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-3.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-4.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-5.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 1 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.1 - 0.15).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 19 out of 191 (10%) covariates across time points, corresponding to 4 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.08 (range= -0.1-0.15):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 1 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         16|            2| 18|</span></span>
<span><span class="co">#&gt; |       15|         25|            3| 28|</span></span>
<span><span class="co">#&gt; |       24|         33|            4| 37|</span></span>
<span><span class="co">#&gt; |       35|         43|            6| 49|</span></span>
<span><span class="co">#&gt; |       58|         55|            4| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Imputation 2**</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-6.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-7.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-8.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-9.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-10.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: For exposure ESETA1 imputation 2 using super and full formulas: </span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.02 (range = -0.09 - 0.13).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, 15 out of 191 (8%) covariates across time points, corresponding to 3 out of 33 domains, remain imbalanced with a remaining median absolute value correlation/std mean difference of 0.08 (range= -0.09-0.13):</span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates for imputation 2 using super and full formulas</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; | exp_time| balanced_n| imbalanced_n|  n|</span></span>
<span><span class="co">#&gt; |--------:|----------:|------------:|--:|</span></span>
<span><span class="co">#&gt; |        6|         18|            0| 18|</span></span>
<span><span class="co">#&gt; |       15|         26|            2| 28|</span></span>
<span><span class="co">#&gt; |       24|         35|            2| 37|</span></span>
<span><span class="co">#&gt; |       35|         42|            7| 49|</span></span>
<span><span class="co">#&gt; |       58|         55|            4| 59|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *** Averaging Across All Imputations ***</span></span></code></pre>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-11.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-12.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-13.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-14.png" width="700"><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-37-15.png" width="700"></p>
<pre><code><span><span class="co">#&gt; USER ALERT: Averaging across all imputed datasets for exposure ESETA1 using the full formulas and super :</span></span>
<span><span class="co">#&gt; The median absolute value relation between exposure and confounder is 0.03 (range = -0.08-0.14).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As shown below, the following 17 covariates across time points out of 191 total (8.9%) spanning 3 domains out of 33 (9.09%) are imbalanced with a remaining median absolute value correlation/std mean difference in relation to ESETA1 of 0.07 (range=-0.08-0.14) :</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Imbalanced Covariates</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |    |exposure | exp_time| covar_time|covariate     |    avg_bal| bal_thresh| balanced|</span></span>
<span><span class="co">#&gt; |:---|:--------|--------:|----------:|:-------------|----------:|----------:|--------:|</span></span>
<span><span class="co">#&gt; |6   |ESETA1   |        6|          0|PmEd2         | -0.0544751|       0.05|        0|</span></span>
<span><span class="co">#&gt; |22  |ESETA1   |       15|          6|ESETA1.6      |  0.1424708|       0.10|        0|</span></span>
<span><span class="co">#&gt; |26  |ESETA1   |       15|          6|InRatioCor.6  | -0.0834839|       0.05|        0|</span></span>
<span><span class="co">#&gt; |31  |ESETA1   |       15|          0|PmEd2         | -0.0543330|       0.05|        0|</span></span>
<span><span class="co">#&gt; |52  |ESETA1   |       24|         15|ESETA1.15     |  0.1022030|       0.10|        0|</span></span>
<span><span class="co">#&gt; |59  |ESETA1   |       24|         15|InRatioCor.15 | -0.0542903|       0.05|        0|</span></span>
<span><span class="co">#&gt; |60  |ESETA1   |       24|          6|InRatioCor.6  | -0.0600302|       0.05|        0|</span></span>
<span><span class="co">#&gt; |92  |ESETA1   |       35|         15|ESETA1.15     |  0.1328705|       0.10|        0|</span></span>
<span><span class="co">#&gt; |93  |ESETA1   |       35|         24|ESETA1.24     |  0.1107459|       0.10|        0|</span></span>
<span><span class="co">#&gt; |94  |ESETA1   |       35|          6|ESETA1.6      |  0.1048666|       0.10|        0|</span></span>
<span><span class="co">#&gt; |102 |ESETA1   |       35|         15|InRatioCor.15 | -0.0682502|       0.05|        0|</span></span>
<span><span class="co">#&gt; |103 |ESETA1   |       35|         24|InRatioCor.24 | -0.0840637|       0.05|        0|</span></span>
<span><span class="co">#&gt; |104 |ESETA1   |       35|          6|InRatioCor.6  | -0.0829595|       0.05|        0|</span></span>
<span><span class="co">#&gt; |155 |ESETA1   |       58|         15|InRatioCor.15 | -0.0635589|       0.05|        0|</span></span>
<span><span class="co">#&gt; |156 |ESETA1   |       58|         24|InRatioCor.24 | -0.0670150|       0.05|        0|</span></span>
<span><span class="co">#&gt; |157 |ESETA1   |       58|         35|InRatioCor.35 | -0.0646489|       0.05|        0|</span></span>
<span><span class="co">#&gt; |158 |ESETA1   |       58|          6|InRatioCor.6  | -0.0614903|       0.05|        0|</span></span></code></pre>
<p>From this, we also find a similar level of imbalance from the same
constructs.</p>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="phase-2-assess-substantive-associations-between-exposure-outcome">Phase 2: Assess Substantive Associations between Exposure &amp;
Outcome<a class="anchor" aria-label="anchor" href="#phase-2-assess-substantive-associations-between-exposure-outcome"></a>
</h2>
<p>Having created IPTW balancing weights that minimize associations
between confounders and exposure at each time point, we can move to the
substantive modeling phase.</p>
<p><br></p>
<div class="section level3">
<h3 id="step-5-fit-marginal-structural-model-summarize-visualize-results">Step 5: Fit Marginal Structural Model &amp; Summarize &amp;
Visualize Results<a class="anchor" aria-label="anchor" href="#step-5-fit-marginal-structural-model-summarize-visualize-results"></a>
</h3>
<p>The goal of this final step is to fit a weighted model relating
exposure at meaningful epochs of developmental time to the outcome,
before summarizing and visualizing the results. In this step, the user
models and compares various counterfactuals, or the effects of different
developmental histories of exposure on the outcome, to test substantive
hypotheses about dose and timing.</p>
<p><br></p>
<div class="section level4">
<h4 id="step-5a--select-fit-a-marginal-outcome-model">Step 5a. Select &amp; Fit a Marginal Outcome Model<a class="anchor" aria-label="anchor" href="#step-5a--select-fit-a-marginal-outcome-model"></a>
</h4>
<p>First, we use the <code><a href="../reference/fitModel.html">fitModel()</a></code> function to fit a weighted
generalized linear model relating exposure to outcome. The function
draws on the <code>svyglm()</code> function of the <em>survey</em>
package (Lumley, 2023). The exposure main effects in models reflect
exposure levels at each exposure time point unless exposure epochs are
specified. One of the benefits of creating balancing weights is that
they can be used in a variety of different marginal outcome models and
those encompassed in this function are only a subset of possible models.
Note that these models can get complex and we do not advise interpreting
the individual terms.</p>
<p>The required inputs for using the <code><a href="../reference/fitModel.html">fitModel()</a></code> function
are: complete data (data frame, mids object, or a list of imputed
datasets as dataframes in wide format), exposure (e.g., “variable”),
exposure time points, outcome (e.g., “variable.t”), a list of trimmed
weights, and a model from the list below (“m0”, “m1”, “m2”, or
“m3”):</p>
<ul>
<li><p><em>M0</em>: Baseline model regressing the outcome on the main
effects of exposure (e.g., infancy, toddlerhood, childhood).</p></li>
<li><p><em>M1</em>: Covariate model regressing the outcome on the main
effects of exposure as well as user-specified covariates (e.g.,
confounders measured at baseline or the first time point that remained
imbalanced after weighting in Step 4).</p></li>
<li><p><em>M2</em>: Interaction model regressing the outcome on the main
effects of exposure as well as all user-specified interactions between
exposure main effects (e.g., infancy:toddlerhood)</p></li>
<li><p><em>M3</em>: Full model regressing the outcome on the main
effects of exposure, user-specified covariates, as well as all
user-specified exposure main effect interactions.</p></li>
</ul>
<p>Below, we specify the full model given that we have
baseline/time-invariant confounders that remain imbalanced from Step 4
and the possiblity of non-linear effects of economic strain on behavior
problems.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"m2"</span></span></code></pre></div>
<p>If the user selects a covariate model (“m1” or “m3”), they are
required to supply a list to <code>covariates</code> that corresponds to
covariates in the wide data (see Step 4).</p>
<p>The optional inputs to the <code><a href="../reference/fitModel.html">fitModel()</a></code> function are as
follows.</p>
<p>The user has the option to specify epochs that differ from the
measurement time points using the optional <code>epochs</code> data
frame field. For epochs: provide a list of user-created names in
quotations (that each constitute a meaningful developmental time period
that will constitute time units for your exposure histories); for
values: as a list, for each epoch, provide a single integer or a list of
integers from the time points at which exposure was measured that
constitute that epoch. If no epochs are specified, the time points at
which exposure was measured will be used in the creation of exposure
histories in the final step of the process. Each specified epoch must
have a corresponding value (but the values can differ in number of
entries as shown below). If the user specifies exposure epochs, exposure
main effects are created for each epoch, and exposure levels are
averaged for any epochs that consist of two or more time point values.
Epochs must be specified in this step if they will be used in the
subsequent step comparing histories, and the specification of exposure
epochs should be kept consistent throughout the use of the
<em>devMSMs</em> package.</p>
<p>Below, we specify Infancy, Toddlerhood, and early Childhood exposure
epochs. Please see the
<a href="https://istallworthy.github.io/devMSMs/articles/Preliminary_Steps.html">Recommended
Preliminary Steps vignette</a> and accomanying manuscript for more
details.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epochs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>epochs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Infancy"</span>, <span class="st">"Toddlerhood"</span>, <span class="st">"Childhood"</span><span class="op">)</span>, </span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>If the user selects an interaction model (“m2” or “m3”), they are
required to provide a interaction order integer in the
<code>int_order</code> field that reflects the maximum interaction
(e.g., 3) (that will automatically include all lower order interactions
(e.g., 2-way)). The interaction order cannot exceed the total number of
exposure main effects (3 in our case, as we specified 3 exposure
epochs).</p>
<p>We specify fitting all 3-way (and constituent) interactions between
exposure main effects.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">int_order</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></code></pre></div>
<p>The user can also specify a <code>family</code> (as a function, not
in quotations; e.g., gaussian) and <code>link</code> (in quotations,
e.g., “identity”) functions for the generalized linear model (defaults
are gaussian and “link”, respectively). The possible families are:
binomial, gaussian, Gama, inverse.gaussian, poisson, quasi,
quasibinomial, and quasipoisson. For binomial and Poisson families, set
family to quasibinomial and quasipoisson, respectively, to avoid a
warning about non-integer numbers of successes. The `quasi’ versions of
the family objects give the same point estimates and standard errors and
do not give the warning. The gaussian family accepts the links:
“identity”, “log” and “inverse”; the binomial family the links “logit”,
“probit”, “cauchit”, (corresponding to logistic, normal and Cauchy CDFs
respectively) “log” and “cloglog” (complementary log-log); the Gamma
family the links “inverse”, “identity”, and “log”; the poisson family
the links “log”, “identity”, and “sqrt”; and the inverse.gaussian family
the links 1/mu^2, inverse, identity and log. The quasi family accepts
the links “logit”, “probit”, “cloglog”, “identity”, “inverse”, “log”,
“1/mu^2”, and “sqrt”, and the function power can be used to create a
power link function. See the <em>survey</em> and <em>stats</em> R
package documentations for more information.</p>
<p>Below, we retain the default family and link functions.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">family</span> <span class="op">&lt;-</span> <span class="va">gaussian</span></span>
<span></span>
<span><span class="va">link</span> <span class="op">&lt;-</span> <span class="st">"identity"</span> </span></code></pre></div>
<p>The <code><a href="../reference/fitModel.html">fitModel()</a></code> function outputs a .rds file of the
fitted model(s) and a .html table of model evidence in the ‘models/’
folder.</p>
<p>Importantly, this function also outputs into the console the result
of a likelihood ratio test comparing the user-specified model to a
nested version of that model that omits all exposure variables to test
whether exposure predicts variation in the outcome. If this test is not
significant and there is no evidence that exposure predicts outcome, we
do not advise proceeding to the subsequent history comparison step.
(Models are pooled prior to conducting the likelihood ratio test for
imputed data.)</p>
<p>This function returns a list of fitted model objects, each as svyglm
output (labeled “0” if data are in data frame format).</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">trim_weights</span></span>
<span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitModel.html">fitModel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, weights <span class="op">=</span> <span class="va">weights</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, <span class="co">#required</span></span>
<span>                   exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, model <span class="op">=</span> <span class="va">model</span>, <span class="co">#required</span></span>
<span>                   family <span class="op">=</span> <span class="va">family</span>, link <span class="op">=</span> <span class="va">link</span>, int_order <span class="op">=</span> <span class="va">int_order</span>, covariates <span class="op">=</span> <span class="va">covariates</span>, epochs <span class="op">=</span> <span class="va">epochs</span>, <span class="co">#optional</span></span>
<span>                   home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Please inspect the following likelihood ratio test to determine if the exposures collective predict significant variation in the outcome compared to a model without exposure terms.</span></span>
<span><span class="co">#&gt; We strongly suggest only conducting history comparisons if the likelihood ratio test is significant.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mitml::testModels(model = fits, null.model = fits.null)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model comparison calculated from 2 imputed data sets.</span></span>
<span><span class="co">#&gt; Combination method: D1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     F.value     df1     df2   P(&gt;F)     RIV </span></span>
<span><span class="co">#&gt;       1.693       7  15.513   0.183   0.745 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unadjusted hypothesis test as appropriate in larger samples.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The marginal model, m2, is summarized below:</span></span></code></pre></div>
<p>We find that the likerlihood ratio test is significant, indicating
that we can proceed to the next step of evaluating the effects of
different exposure histories.</p>
<p><br></p>
<p>We first conduct sensitivity analyses, fitting the same model with
weights that were trimmed at two different values.</p>
<p>Of note, as described in Step 4, if <code>save.out = TRUE</code>,
running these analyses will overwrite the output from the main model
fitting above if the main output is not renamed or relocated to a new
folder first.</p>
<p>We first fit the same model to the weights trimmed at the 92nd
quantile.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">trim_weights.s1</span></span>
<span></span>
<span><span class="va">models.s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitModel.html">fitModel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, weights <span class="op">=</span> <span class="va">weights</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, <span class="co">#required</span></span>
<span>                      exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, model <span class="op">=</span> <span class="va">model</span>, <span class="co">#required</span></span>
<span>                      family <span class="op">=</span> <span class="va">family</span>, link <span class="op">=</span> <span class="va">link</span>, int_order <span class="op">=</span> <span class="va">int_order</span>, covariates <span class="op">=</span> <span class="va">covariates</span>, epochs <span class="op">=</span> <span class="va">epochs</span>, <span class="co">#optional</span></span>
<span>                      home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Please inspect the following likelihood ratio test to determine if the exposures collective predict significant variation in the outcome compared to a model without exposure terms.</span></span>
<span><span class="co">#&gt; We strongly suggest only conducting history comparisons if the likelihood ratio test is significant.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mitml::testModels(model = fits, null.model = fits.null)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model comparison calculated from 2 imputed data sets.</span></span>
<span><span class="co">#&gt; Combination method: D1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     F.value     df1     df2   P(&gt;F)     RIV </span></span>
<span><span class="co">#&gt;       1.920       7  16.493   0.131   0.686 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unadjusted hypothesis test as appropriate in larger samples.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The marginal model, m2, is summarized below:</span></span></code></pre></div>
<p>We similarly find a significant likelihoood ratio test.</p>
<p><b></b></p>
<p>We then fit the same model with the weights trimmed at the 98th
quantile.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">trim_weights.s2</span></span>
<span></span>
<span><span class="va">models.s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitModel.html">fitModel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, weights <span class="op">=</span> <span class="va">weights</span>, exposure <span class="op">=</span> <span class="va">exposure</span>, <span class="co">#required</span></span>
<span>                      exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, model <span class="op">=</span> <span class="va">model</span>, <span class="co">#required</span></span>
<span>                      family <span class="op">=</span> <span class="va">family</span>, link <span class="op">=</span> <span class="va">link</span>, int_order <span class="op">=</span> <span class="va">int_order</span>, covariates <span class="op">=</span> <span class="va">covariates</span>, epochs <span class="op">=</span> <span class="va">epochs</span>, <span class="co">#optional</span></span>
<span>                      home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Please inspect the following likelihood ratio test to determine if the exposures collective predict significant variation in the outcome compared to a model without exposure terms.</span></span>
<span><span class="co">#&gt; We strongly suggest only conducting history comparisons if the likelihood ratio test is significant.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mitml::testModels(model = fits, null.model = fits.null)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model comparison calculated from 2 imputed data sets.</span></span>
<span><span class="co">#&gt; Combination method: D1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     F.value     df1     df2   P(&gt;F)     RIV </span></span>
<span><span class="co">#&gt;       1.416       7  14.525   0.271   0.818 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unadjusted hypothesis test as appropriate in larger samples.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The marginal model, m2, is summarized below:</span></span></code></pre></div>
<p>With a comparable result.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="step-5b--estimate-compare-and-cisualize-model-predicted-outcome-as-a-function-of-exposure-history">Step 5b. Estimate, Compare, and Cisualize Model-Predicted Outcome as
a Function of Exposure History<a class="anchor" aria-label="anchor" href="#step-5b--estimate-compare-and-cisualize-model-predicted-outcome-as-a-function-of-exposure-history"></a>
</h4>
<p>In this final step, we use the fitted model results to test
substantive hypotheses about dose and timing. We estimate and then
compare the average marginal estimates of the outcome for each
user-specified exposure history (i.e., permutation of high (“h) and low
(“l”) levels of exposure at each exposure epoch) using the
<code><a href="../reference/compareHistories.html">compareHistories()</a></code> function. This draws primarily from the
<code>avg_predictions()</code> and <code>hypotheses()</code> functions
in the <em>marginaleffects</em> package (Arel-Bundock, 2023).</p>
<p>First, the <code><a href="../reference/compareHistories.html">compareHistories()</a></code> function creates average
predictions of the outcome for each exposure history. For each of the
<em>n</em> combinations of user-specified exposure histories, we set the
value of those predictors in the full dataset to the values in that
combination, leaving all other variables as they are. This gives us
<em>n</em> datasets, each the same size as our original dataset used to
fit the model. For the <em>n</em> datasets, we then compute the
predicted values given the model before taking the average predicted
value for each of the <em>n</em> datasets. These <em>n</em> averaged
predicted values are the expected potential outcomes under each
combination. (For imputed data, the function outputs pooled predicted
values using Rubin’s Rules.)</p>
<p>Next, using the predicted values, the function conducts comparisons
of the different histories (pooling across imputed datasets for imputed
data using Rubin’s Rules). Lastly, the function implements correction
for multiple comparisons (treating each run of the function as a family)
before plotting the results. Box plots display outcome on the x-axis and
exposure history on the y-axis and whiskers display standard errors.</p>
<p>The required inputs for using the <code><a href="../reference/compareHistories.html">compareHistories()</a></code>
function are: exposure (e.g., “variable”), outcome (e.g., “variable.t”),
and a list of model output from Step 5a.</p>
<p>The optional inputs are as follows.</p>
<p>To create histories of high and low values with continuous exposures,
to <code>hi_lo_cut</code> the user can specify a list of two quantile
values (0-1; default is median split +/- 0.001) demarcating high and low
levels of exposure, respectively. (Imputed data are stacked to calculate
cutoff values.) We suggest drawing on existing hypotheses and examining
the variability in the exposure variable to determine high and low
cutoffs. We recommend users begin by specifying meaningful high and low
percentile cutoffs and examining how many individuals in the sample fall
into each of the user-specified exposure histories created by those
percentile cutoffs (see the
<a href="https://istallworthy.github.io/devMSMs/articles/Preliminary_Steps.html">Recommended
Preliminary Steps vignette</a>). While there are no gold standard
recommendations for sufficient cell numbers per history, users should
ensure that there is is reasonable coverage in all of their histories to
avoid extrapolation and maximize precision.</p>
<p>Below, we specify that 60th and 30th percentile values to denote high
and low levels of economic strain, respectively.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hi_lo_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.3</span><span class="op">)</span> </span></code></pre></div>
<p>Additionally, the user has the option to specify epochs that differ
from the exposure time points using the optional <code>epochs</code>
data frame field (see Step 5a above). If the user specified epochs in
Step 5a for the <code><a href="../reference/fitModel.html">fitModel()</a></code> function, they must also specify
them at this step.</p>
<p>The user also has the option to estimate and compare only a custom
subset of user-specified exposure histories (i.e., sequences of high and
low levels of exposure at each epoch or time point) using the
<code>reference</code> and <code>comparison</code> fields. To conduct
these recommended customized comparisons, users must provide at least
one unique valid history (e.g., “l-l-l”) as a reference by, in
quotations, provide a string (or a list of strings) of lowercase l’s and
h’s (each separated by -), each corresponding to each exposure epoch (or
time point), that signify the sequence of exposure levels (“low” or
“high”, respectively). If the user supplies a reference history, they
are required to provide at least one unique and valid history for
comparison by, in quotations, providing to <code>comparison</code> a
string (or list of strings) of l’s and h’s (each separated by “-”), with
each corresponding to each exposure epoch, that signify the sequence of
exposure levels (“low” or “high”, respectively) that constitutes the
comparison exposure history/histories to be compared to the reference.
If the user supplies one or more comparisons, at least one reference
must be specified. Each reference exposure history will be compared to
each comparison history and all comparisons will be subject to multiple
comparison correction. If no reference or comparison is specified, all
histories will be compared to each other. If there are more than 4
exposure main effects (either as epochs or exposure time points), the
user is required to select a subset of history comparisons (Step 5b),
given that the base code (see the <code>hypotheses()</code> function
from the <em>marginaleffects</em> package; Arel-Bundock, 2023) cannot
accommodate all pairwise history comparisons for more than 5 time
points.</p>
<p>Below, we specify one reference and two comparison histories.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference</span> <span class="op">&lt;-</span> <span class="st">"l-l-l"</span> </span>
<span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"h-h-h"</span>, <span class="st">"l-l-h"</span>, <span class="st">"h-l-l"</span>, <span class="st">"l-h-l"</span><span class="op">)</span> </span></code></pre></div>
<p>The user can also specify a multiple comparison method in
<code>mc_method</code> by in quotations, providing the shorthand for the
method (“holm”, “hochberg”,“hommel”, “bonferroni”, “BH” (default), “BY”,
“fdr”, or “n” (see stats::p.adjust documentation; R Core Team) for
multiple comparison correction to be applied to the final (pooled across
imputed datasets when applicable) contrasts comparing effects of
different exposure histories on outcome (default is Benjamini-Hochburg).
Each code run is considered a family. If the user iterates through this
function specifying different comparisons each time, we strongly
recommend interpreting the outcome of the most inclusive set of
comparisons to avoid false discovery.</p>
<p>Below, we retain the default Benjamini-Hochburg method for multiple
comparison.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_comp_method</span> <span class="op">&lt;-</span> <span class="st">"BH"</span></span></code></pre></div>
<p>Based on their substantive interests, the user also has the option to
choose which level of dosage (“h” or “l”) is tallied in labels of dose
counts in the tables and figures (<code>dose_level</code>; default is
“h”). For example, if the exposure variable was coded in such a way that
lower levels are conceptualized as the exposure (e.g., lower income),
the user may wish to choose dosage level “l”.</p>
<p>Below, given our interest in histories of high economic strain, we
specify that we wish to tally high doses of exposure.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dose_level</span> <span class="op">&lt;-</span> <span class="st">"h"</span></span></code></pre></div>
<p>Lastly, the user can provide alternate plotting labels for exposure
and outcome in the <code>exp_lab</code> and <code>out_lab</code> fields
(defaults are variable names), as well as a list (equal to number of
exposure main effects +1) of colors or a Brewer color palette (colors;
default is “Dark2”). See RColorBrewer::display.brewer.all() or <a href="https://r-graph-gallery.com/38-rcolorbrewers-palettes.html" class="external-link uri">https://r-graph-gallery.com/38-rcolorbrewers-palettes.html</a>).</p>
<p>Below, we specify plotting labels and 4 colors.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_lab</span> <span class="op">&lt;-</span> <span class="st">"Economic Strain"</span> </span>
<span></span>
<span><span class="va">out_lab</span> <span class="op">&lt;-</span> <span class="st">"Behavior Problems"</span> </span>
<span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue4"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkgoldenrod"</span>, <span class="st">"red2"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/compareHistories.html">compareHistories()</a></code> function saves out .html tables
of the estimated mean outcome values for each history and history
comparisons in the ‘histories/’ folder and a boxplot of predicted values
for the histories in the ‘plots/’ folder.</p>
<p>The function returns a data frame of user-specified history
comparisons containing contrast estimates, standard errors, statistics,
p-values, low and high confidence intervals, and corrected p-values,
labeled by history and dose.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">models</span> </span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compareHistories.html">compareHistories</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, model <span class="op">=</span> <span class="va">model</span>, <span class="co">#required</span></span>
<span>                            epochs <span class="op">=</span> <span class="va">epochs</span>, hi_lo_cut <span class="op">=</span> <span class="va">hi_lo_cut</span>, reference <span class="op">=</span> <span class="va">reference</span>, comparison <span class="op">=</span> <span class="va">comparison</span>, <span class="co">#optional</span></span>
<span>                            mc_comp_method <span class="op">=</span> <span class="va">mc_comp_method</span>, dose_level <span class="op">=</span> <span class="va">dose_level</span>, exp_lab <span class="op">=</span> <span class="va">exp_lab</span>, out_lab <span class="op">=</span> <span class="va">out_lab</span>, colors <span class="op">=</span> <span class="va">colors</span>, <span class="co">#optional</span></span>
<span>                            home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Summary of Exposure Main Effects: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; USER ALERT: Out of the total of 1292 individuals in the sample, below is the distribution of the 390 (30.19%) individuals that fall into 5 out of the 5 the total user-defined exposure histories created from 30th and 60th percentile values for low and high levels of exposure ESETA1, respectively, across Infancy, Toddlerhood, Childhood. </span></span>
<span><span class="co">#&gt; USER ALERT: Please inspect the distribution of the sample across the following exposure histories and ensure there is sufficient spread to avoid extrapolation and low precision: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Summary of user-specified exposure ESETA1 histories based on exposure main effects Infancy, Toddlerhood, Childhood containing time points 6, 15, 24:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |history |   n|</span></span>
<span><span class="co">#&gt; |:-------|---:|</span></span>
<span><span class="co">#&gt; |h-h-h   | 206|</span></span>
<span><span class="co">#&gt; |h-l-l   |  18|</span></span>
<span><span class="co">#&gt; |l-h-l   |  26|</span></span>
<span><span class="co">#&gt; |l-l-h   |  29|</span></span>
<span><span class="co">#&gt; |l-l-l   | 111|</span></span>
<span><span class="co">#&gt; Warning in get.dfcom(object, dfcom): Infinite sample size assumed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Below are the pooled average predictions by user-specified history:|   |term                                                                            | estimate| std.error| statistic|       df| p.value|history | dose_count|</span></span>
<span><span class="co">#&gt; |:--|:-------------------------------------------------------------------------------|--------:|---------:|---------:|--------:|-------:|:-------|----------:|</span></span>
<span><span class="co">#&gt; |1  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = -0.345 |   0.4708|    0.0119|   39.4355| 300.7339|   0e+00|l-l-l   |          0|</span></span>
<span><span class="co">#&gt; |2  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = 0.452, ESETA1.Childhood = -0.345  |   0.4741|    0.0200|   23.6563|   3.2264|   1e-04|l-h-l   |          1|</span></span>
<span><span class="co">#&gt; |3  |ESETA1.Infancy = 0.545, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = -0.345  |   0.4787|    0.0150|   31.8369|  72.2793|   0e+00|h-l-l   |          1|</span></span>
<span><span class="co">#&gt; |5  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = 0.31   |   0.4794|    0.0175|   27.3796|   6.3288|   0e+00|l-l-h   |          1|</span></span>
<span><span class="co">#&gt; |8  |ESETA1.Infancy = 0.545, ESETA1.Toddlerhood = 0.452, ESETA1.Childhood = 0.31     |   0.4919|    0.0118|   41.8544|  20.7429|   0e+00|h-h-h   |          3|</span></span>
<span><span class="co">#&gt; Warning in get.dfcom(object, dfcom): Infinite sample size assumed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conducting multiple comparison correction for all pairings between comparison histories and each refernece history using the BH method. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; USER ALERT: please inspect the following pooled comparisons : </span></span>
<span><span class="co">#&gt; |term                                               | estimate| std.error| statistic|       df| p.value|history        |dose   | p.value_corr|</span></span>
<span><span class="co">#&gt; |:--------------------------------------------------|--------:|---------:|---------:|--------:|-------:|:--------------|:------|------------:|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (0.545, 0.452, 0.31)    |   0.0211|    0.0138|    1.5264|   7.4544|  0.1682|l-l-l vs h-h-h |0 vs 3 |       0.6726|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (0.545, -0.284, -0.345) |   0.0079|    0.0102|    0.7782| 394.8543|  0.4369|l-l-l vs h-l-l |0 vs 1 |       0.6791|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (-0.209, 0.452, -0.345) |   0.0033|    0.0203|    0.1623|   1.6682|  0.8885|l-l-l vs l-h-l |0 vs 1 |       0.8885|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (-0.209, -0.284, 0.31)  |   0.0086|    0.0120|    0.7137|   4.6930|  0.5093|l-l-l vs l-l-h |0 vs 1 |       0.6791|</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-50-1.png" width="700"></p>
<p>As shown above, we first confirm that there is reasonable
distribution of our sample with each of the specified exposure
histories.</p>
<p>We then inspect the history comparison and conclude that there is no
evidence that children who experienced different histories of exposure
to economic strain over infancy, toddlerhood, and early childhood differ
in their behavioral problems in early childhood.</p>
<p><br></p>
<p>We then conduct sensitivity analyses by assessing and comparing
histories drawing from models that used weights trimmed at two different
values. Of note, running these analyses will overwrite the output from
the main history comparison above if the main output is not renamed or
relocated to a new folder first.</p>
<p>We first compare the same histories using the model fit with weights
trimmed at the 92nd quantile value.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">models.s1</span> </span>
<span></span>
<span><span class="va">results.s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compareHistories.html">compareHistories</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, model <span class="op">=</span> <span class="va">model</span>, <span class="co">#required</span></span>
<span>                               epochs <span class="op">=</span> <span class="va">epochs</span>, hi_lo_cut <span class="op">=</span> <span class="va">hi_lo_cut</span>, reference <span class="op">=</span> <span class="va">reference</span>, comparison <span class="op">=</span> <span class="va">comparison</span>, <span class="co">#optional</span></span>
<span>                               mc_comp_method <span class="op">=</span> <span class="va">mc_comp_method</span>, dose_level <span class="op">=</span> <span class="va">dose_level</span>, exp_lab <span class="op">=</span> <span class="va">exp_lab</span>, out_lab <span class="op">=</span> <span class="va">out_lab</span>, colors <span class="op">=</span> <span class="va">colors</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Summary of Exposure Main Effects: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; USER ALERT: Out of the total of 1292 individuals in the sample, below is the distribution of the 390 (30.19%) individuals that fall into 5 out of the 5 the total user-defined exposure histories created from 30th and 60th percentile values for low and high levels of exposure ESETA1, respectively, across Infancy, Toddlerhood, Childhood. </span></span>
<span><span class="co">#&gt; USER ALERT: Please inspect the distribution of the sample across the following exposure histories and ensure there is sufficient spread to avoid extrapolation and low precision: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Summary of user-specified exposure ESETA1 histories based on exposure main effects Infancy, Toddlerhood, Childhood containing time points 6, 15, 24:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |history |   n|</span></span>
<span><span class="co">#&gt; |:-------|---:|</span></span>
<span><span class="co">#&gt; |h-h-h   | 206|</span></span>
<span><span class="co">#&gt; |h-l-l   |  18|</span></span>
<span><span class="co">#&gt; |l-h-l   |  26|</span></span>
<span><span class="co">#&gt; |l-l-h   |  29|</span></span>
<span><span class="co">#&gt; |l-l-l   | 111|</span></span>
<span><span class="co">#&gt; Warning in get.dfcom(object, dfcom): Infinite sample size assumed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Below are the pooled average predictions by user-specified history:|   |term                                                                            | estimate| std.error| statistic|       df| p.value|history | dose_count|</span></span>
<span><span class="co">#&gt; |:--|:-------------------------------------------------------------------------------|--------:|---------:|---------:|--------:|-------:|:-------|----------:|</span></span>
<span><span class="co">#&gt; |1  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = -0.345 |   0.4690|    0.0118|   39.6932| 181.1025|       0|l-l-l   |          0|</span></span>
<span><span class="co">#&gt; |2  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = 0.452, ESETA1.Childhood = -0.345  |   0.4732|    0.0192|   24.6665|   3.5287|       0|l-h-l   |          1|</span></span>
<span><span class="co">#&gt; |3  |ESETA1.Infancy = 0.545, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = -0.345  |   0.4774|    0.0152|   31.3396|  45.5702|       0|h-l-l   |          1|</span></span>
<span><span class="co">#&gt; |5  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = 0.31   |   0.4778|    0.0176|   27.1209|   5.5255|       0|l-l-h   |          1|</span></span>
<span><span class="co">#&gt; |8  |ESETA1.Infancy = 0.545, ESETA1.Toddlerhood = 0.452, ESETA1.Childhood = 0.31     |   0.4917|    0.0110|   44.5150|  43.4502|       0|h-h-h   |          3|</span></span>
<span><span class="co">#&gt; Warning in get.dfcom(object, dfcom): Infinite sample size assumed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conducting multiple comparison correction for all pairings between comparison histories and each refernece history using the BH method. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; USER ALERT: please inspect the following pooled comparisons : </span></span>
<span><span class="co">#&gt; |term                                               | estimate| std.error| statistic|       df| p.value|history        |dose   | p.value_corr|</span></span>
<span><span class="co">#&gt; |:--------------------------------------------------|--------:|---------:|---------:|--------:|-------:|:--------------|:------|------------:|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (0.545, 0.452, 0.31)    |   0.0226|    0.0132|    1.7218|   9.3380|  0.1180|l-l-l vs h-h-h |0 vs 3 |       0.4719|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (0.545, -0.284, -0.345) |   0.0084|    0.0102|    0.8238| 221.7269|  0.4109|l-l-l vs h-l-l |0 vs 1 |       0.6684|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (-0.209, 0.452, -0.345) |   0.0042|    0.0196|    0.2127|   1.6945|  0.8543|l-l-l vs l-h-l |0 vs 1 |       0.8543|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (-0.209, -0.284, 0.31)  |   0.0088|    0.0120|    0.7319|   4.4065|  0.5013|l-l-l vs l-l-h |0 vs 1 |       0.6684|</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<p>As shown above, results indicate a marginal but non-significant
contrast between “l-l-l” and “h-h-h” histories of economic strain
exposure in relation to behavior problems in early childhood.</p>
<p><br></p>
<p>We then compare the same histories usign the model fit with weights
trimmed at the 98th quantile value.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">models.s2</span> </span>
<span></span>
<span><span class="va">results.s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compareHistories.html">compareHistories</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">exposure</span>, exposure_time_pts <span class="op">=</span> <span class="va">exposure_time_pts</span>, outcome <span class="op">=</span> <span class="va">outcome</span>, model <span class="op">=</span> <span class="va">model</span>, <span class="co">#required</span></span>
<span>                               epochs <span class="op">=</span> <span class="va">epochs</span>, hi_lo_cut <span class="op">=</span> <span class="va">hi_lo_cut</span>, reference <span class="op">=</span> <span class="va">reference</span>, comparison <span class="op">=</span> <span class="va">comparison</span>, <span class="co">#optional</span></span>
<span>                               mc_comp_method <span class="op">=</span> <span class="va">mc_comp_method</span>, dose_level <span class="op">=</span> <span class="va">dose_level</span>, exp_lab <span class="op">=</span> <span class="va">exp_lab</span>, out_lab <span class="op">=</span> <span class="va">out_lab</span>, colors <span class="op">=</span> <span class="va">colors</span>, <span class="co">#optional</span></span>
<span>                               home_dir <span class="op">=</span> <span class="va">home_dir</span>, verbose <span class="op">=</span> <span class="va">verbose</span>, save.out <span class="op">=</span> <span class="va">save.out</span><span class="op">)</span> <span class="co">#optional</span></span>
<span><span class="co">#&gt; Summary of Exposure Main Effects: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; USER ALERT: Out of the total of 1292 individuals in the sample, below is the distribution of the 390 (30.19%) individuals that fall into 5 out of the 5 the total user-defined exposure histories created from 30th and 60th percentile values for low and high levels of exposure ESETA1, respectively, across Infancy, Toddlerhood, Childhood. </span></span>
<span><span class="co">#&gt; USER ALERT: Please inspect the distribution of the sample across the following exposure histories and ensure there is sufficient spread to avoid extrapolation and low precision: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Table: Summary of user-specified exposure ESETA1 histories based on exposure main effects Infancy, Toddlerhood, Childhood containing time points 6, 15, 24:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |history |   n|</span></span>
<span><span class="co">#&gt; |:-------|---:|</span></span>
<span><span class="co">#&gt; |h-h-h   | 206|</span></span>
<span><span class="co">#&gt; |h-l-l   |  18|</span></span>
<span><span class="co">#&gt; |l-h-l   |  26|</span></span>
<span><span class="co">#&gt; |l-l-h   |  29|</span></span>
<span><span class="co">#&gt; |l-l-l   | 111|</span></span>
<span><span class="co">#&gt; Warning in get.dfcom(object, dfcom): Infinite sample size assumed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Below are the pooled average predictions by user-specified history:|   |term                                                                            | estimate| std.error| statistic|        df| p.value|history | dose_count|</span></span>
<span><span class="co">#&gt; |:--|:-------------------------------------------------------------------------------|--------:|---------:|---------:|---------:|-------:|:-------|----------:|</span></span>
<span><span class="co">#&gt; |1  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = -0.345 |   0.4722|    0.0120|   39.3873| 5759.5105|   0e+00|l-l-l   |          0|</span></span>
<span><span class="co">#&gt; |2  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = 0.452, ESETA1.Childhood = -0.345  |   0.4762|    0.0223|   21.3924|    2.6216|   5e-04|l-h-l   |          1|</span></span>
<span><span class="co">#&gt; |3  |ESETA1.Infancy = 0.545, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = -0.345  |   0.4793|    0.0149|   32.2171|  183.5163|   0e+00|h-l-l   |          1|</span></span>
<span><span class="co">#&gt; |5  |ESETA1.Infancy = -0.209, ESETA1.Toddlerhood = -0.284, ESETA1.Childhood = 0.31   |   0.4806|    0.0172|   28.0125|    7.7137|   0e+00|l-l-h   |          1|</span></span>
<span><span class="co">#&gt; |8  |ESETA1.Infancy = 0.545, ESETA1.Toddlerhood = 0.452, ESETA1.Childhood = 0.31     |   0.4925|    0.0132|   37.2860|    8.9101|   0e+00|h-h-h   |          3|</span></span>
<span><span class="co">#&gt; Warning in get.dfcom(object, dfcom): Infinite sample size assumed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conducting multiple comparison correction for all pairings between comparison histories and each refernece history using the BH method. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; USER ALERT: please inspect the following pooled comparisons : </span></span>
<span><span class="co">#&gt; |term                                               | estimate| std.error| statistic|       df| p.value|history        |dose   | p.value_corr|</span></span>
<span><span class="co">#&gt; |:--------------------------------------------------|--------:|---------:|---------:|--------:|-------:|:--------------|:------|------------:|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (0.545, 0.452, 0.31)    |   0.0204|    0.0145|    1.4044|   6.6619|  0.2051|l-l-l vs h-h-h |0 vs 3 |       0.7239|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (0.545, -0.284, -0.345) |   0.0071|    0.0105|    0.6783| 243.2631|  0.4982|l-l-l vs h-l-l |0 vs 1 |       0.7239|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (-0.209, 0.452, -0.345) |   0.0040|    0.0212|    0.1893|   1.6049|  0.8710|l-l-l vs l-h-l |0 vs 1 |       0.8710|</span></span>
<span><span class="co">#&gt; |(-0.209, -0.284, -0.345) - (-0.209, -0.284, 0.31)  |   0.0084|    0.0127|    0.6618|   4.1634|  0.5429|l-l-l vs l-l-h |0 vs 1 |       0.7239|</span></span></code></pre></div>
<p><img src="Workflow_Continuous_Exposure_files/figure-html/unnamed-chunk-52-1.png" width="700"></p>
<p>Similarly, we find no evidence for differences in behavioral problems
as function of history of exposure to economic strain.</p>
<p><br><br></p>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Arel-Bundock, V. 2023. marginaleffects: Predictions, Comparisons,
Slopes, Marginal Means,and Hypothesis Tests. <a href="https://CRAN.R-project.org/package=marginaleffects" class="external-link uri">https://CRAN.R-project.org/package=marginaleffects</a>.</p>
<p>Burchinal, M., Howes, C., Pianta, R., Bryant, D., Early, D.,
Clifford, R., &amp; Barbarin, O. (2008). Predicting Child Outcomes at
the End of Kindergarten from the Quality of Pre-Kindergarten
Teacher–Child Interactions and Instruction. Applied Developmental
Science, 12(3), 140–153. <a href="https://doi.org/10.1080/10888690802199418" class="external-link uri">https://doi.org/10.1080/10888690802199418</a></p>
<p>Cole, S. R., &amp; Hernán, M. A. (2008). Constructing Inverse
Probability Weights for Marginal Structural Models. American Journal of
Epidemiology, 168(6), 656–664. <a href="https://doi.org/10.1093/aje/kwn164" class="external-link uri">https://doi.org/10.1093/aje/kwn164</a>.</p>
<p>Greifer, Noah. 2023.WeightIt: Weighting for Covariate Balance in
Observational Studies. <a href="https://CRAN.R-project.org/package=WeightIt" class="external-link uri">https://CRAN.R-project.org/package=WeightIt</a>.</p>
<p>Jackson, John W. (2016). Diagnostics for Confounding of Time-varying
and Other Joint Exposures. Epidemiology, 2016 Nov, 27(6), 859-69. <a href="https://doi.org/10.1097/EDE.0000000000000547" class="external-link uri">https://doi.org/10.1097/EDE.0000000000000547</a>.</p>
<p>Lumley, Thomas. 2023. “survey: Analysis of Complex Survey
Samples.”</p>
<p>Polley, Eric, Erin LeDell, Chris Kennedy, and Mark van der Laan.
2023. SuperLearner: SuperLearner Prediction. <a href="https://CRAN.R-project.org/package=SuperLearner" class="external-link uri">https://CRAN.R-project.org/package=SuperLearner</a>.</p>
<p>R Core Team (2013). R: A language and environment for statistical
computing. R Foundation for Statistical Computing, Vienna, Austria. ISBN
3-900051-07-0, URLhttp://www.R-project.org/.</p>
<p>Stuart, E. A. (2010). Matching methods for causal inference: A review
and a look forward. Statistical Science: A Review Journal of the
Institute of Mathematical Statistics, 25(1), 1–21. <a href="https://doi.org/10.1214/09-STS313" class="external-link uri">https://doi.org/10.1214/09-STS313</a>.</p>
<p>Thoemmes, F., &amp; Ong, A. D. (2016). A Primer on Inverse
Probability of Treatment Weighting and Marginal Structural Models. <a href="https://doi.org/10.1177/2167696815621645" class="external-link uri">https://doi.org/10.1177/2167696815621645</a>.</p>
<p>Vernon-Feagans, L., Cox, M., Willoughby, M., Burchinal, M.,
Garrett-Peters, P., Mills-Koonce, R., Garrett-Peiers, P., Conger, R. D.,
&amp; Bauer, P. J. (2013). The Family Life Project: An Epidemiological
and Developmental Study of Young Children Living in Poor Rural
Communities. Monographs of the Society for Research in Child
Development, 78(5), i–150.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Isabella Stallworthy, Noah Greifer, Meriah DeJoseph, Emily Padrutt, Daniel Berry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
